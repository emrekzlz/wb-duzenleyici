<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Profesyonel BaÅŸlÄ±k DÃ¼zenleyici (Manager Mode)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* Ã–nceki ÅŸÄ±k tasarÄ±m korundu */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); padding: 40px; }
        h1 { color: #1a202c; text-align: center; margin-bottom: 10px; font-size: 2.2em; }
        .subtitle { text-align: center; color: #718096; margin-bottom: 30px; font-size: 1.1em; }
        .upload-area { border: 3px dashed #cbd5e0; border-radius: 15px; padding: 50px; text-align: center; background: #f7fafc; cursor: pointer; transition: 0.3s; }
        .upload-area:hover { border-color: #2a5298; background: #ebf8ff; }
        .rules-box { background: #fff5f5; border-left: 4px solid #fc8181; padding: 20px; margin: 30px 0; border-radius: 8px; }
        .rules-title { font-weight: bold; color: #c53030; margin-bottom: 10px; }
        .rules-list { font-size: 0.9em; color: #742a2a; margin-left: 20px; }
        .btn { display: inline-block; background: #2a5298; color: white; padding: 15px 40px; border-radius: 8px; text-decoration: none; font-weight: bold; cursor: pointer; border: none; margin-top: 20px; }
        .btn:hover { background: #1e3c72; }
        .preview-table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
        .preview-table th { background: #2d3748; color: white; padding: 12px; text-align: left; }
        .preview-table td { border-bottom: 1px solid #e2e8f0; padding: 10px; }
        #progressContainer { display: none; margin: 20px 0; }
        .progress-bar { width: 100%; height: 20px; background: #edf2f7; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: #48bb78; width: 0%; transition: width 0.3s; }
        #resultArea { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ WB Profesyonel BaÅŸlÄ±k DÃ¼zenleyici</h1>
        <p class="subtitle">Wildberries AlgoritmasÄ± ve YÃ¶netici StandartlarÄ±na Uygun Temizlik</p>

        <div class="upload-area" id="uploadArea">
            <div style="font-size: 3em; margin-bottom: 15px;">ğŸ“‚</div>
            <div>DosyayÄ± SÃ¼rÃ¼kle veya TÄ±kla (.xlsx)</div>
            <input type="file" id="fileInput" accept=".xlsx,.xls">
        </div>

        <div class="rules-box">
            <div class="rules-title">âš ï¸ Uygulanan KatÄ± Kurallar:</div>
            <ul class="rules-list">
                <li><b>1. GÃ¼rÃ¼ltÃ¼ TemizliÄŸi:</b> "Yuvarlak yaka", "Uzun kol", "2 adet", "Set" ifadeleri silinir.</li>
                <li><b>2. ÃœrÃ¼n OdaklÄ±:</b> ÃœrÃ¼n ismi (Ã–rn: TiÅŸÃ¶rt) cÃ¼mlenin en baÅŸÄ±na taÅŸÄ±nÄ±r.</li>
                <li><b>3. AkÄ±llÄ± Gramer:</b> HatalÄ± Ã§oÄŸullar (TiÅŸÃ¶rtler â†’ TiÅŸÃ¶rt) dÃ¼zeltilir, Åort/Pantolon korunur.</li>
                <li><b>4. Hedef Kitle:</b> "KadÄ±n", "Erkek" gibi kelimeler "KadÄ±nlar iÃ§in" formatÄ±na Ã§evrilir.</li>
                <li><b>5. SÄ±nÄ±r:</b> Maksimum 60 karakter, noktalama iÅŸareti yok.</li>
            </ul>
        </div>

        <div id="progressContainer">
            <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
            <div style="text-align: center; margin-top: 5px;" id="progressText">0%</div>
        </div>

        <div id="resultArea">
            <div style="text-align: center;">
                <button class="btn" id="downloadBtn">ğŸ“¥ DÃ¼zenlenmiÅŸ DosyayÄ± Ä°ndir</button>
            </div>
            <div id="previewContainer"></div>
        </div>
    </div>

    <script>
        class WBManagerCleaner {
            constructor() {
                // 1. ÃœrÃ¼n Ä°simleri (Ã–ne Ã§ekilecek ve tekil yapÄ±lacaklar)
                this.urunSozlugu = {
                    'Ñ„ÑƒÑ‚Ğ±Ğ¾Ğ»ĞºĞ¸': 'Ğ¤ÑƒÑ‚Ğ±Ğ¾Ğ»ĞºĞ°', 'Ñ„ÑƒÑ‚Ğ±Ğ¾Ğ»ĞºĞ°': 'Ğ¤ÑƒÑ‚Ğ±Ğ¾Ğ»ĞºĞ°',
                    'Ñ€ÑƒĞ±Ğ°ÑˆĞºĞ¸': 'Ğ ÑƒĞ±Ğ°ÑˆĞºĞ°', 'Ñ€ÑƒĞ±Ğ°ÑˆĞºĞ°': 'Ğ ÑƒĞ±Ğ°ÑˆĞºĞ°',
                    'Ğ±Ğ»ÑƒĞ·ĞºĞ¸': 'Ğ‘Ğ»ÑƒĞ·ĞºĞ°', 'Ğ±Ğ»ÑƒĞ·ĞºĞ°': 'Ğ‘Ğ»ÑƒĞ·ĞºĞ°',
                    'Ğ¿Ğ»Ğ°Ñ‚ÑŒÑ': 'ĞŸĞ»Ğ°Ñ‚ÑŒĞµ', 'Ğ¿Ğ»Ğ°Ñ‚ÑŒĞµ': 'ĞŸĞ»Ğ°Ñ‚ÑŒĞµ',
                    'ĞºĞ¾ÑÑ‚ÑĞ¼Ñ‹': 'ĞšĞ¾ÑÑ‚ÑĞ¼', 'ĞºĞ¾ÑÑ‚ÑĞ¼': 'ĞšĞ¾ÑÑ‚ÑĞ¼',
                    'ÑĞ²Ğ¸Ñ‚ĞµÑ€Ğ°': 'Ğ¡Ğ²Ğ¸Ñ‚ĞµÑ€', 'ÑĞ²Ğ¸Ñ‚ĞµÑ€': 'Ğ¡Ğ²Ğ¸Ñ‚ĞµÑ€',
                    'Ğ´Ğ¶ĞµĞ¼Ğ¿ĞµÑ€Ñ‹': 'Ğ”Ğ¶ĞµĞ¼Ğ¿ĞµÑ€', 'Ğ´Ğ¶ĞµĞ¼Ğ¿ĞµÑ€': 'Ğ”Ğ¶ĞµĞ¼Ğ¿ĞµÑ€',
                    'Ñ‚Ğ¾Ğ»ÑÑ‚Ğ¾Ğ²ĞºĞ¸': 'Ğ¢Ğ¾Ğ»ÑÑ‚Ğ¾Ğ²ĞºĞ°', 'Ñ‚Ğ¾Ğ»ÑÑ‚Ğ¾Ğ²ĞºĞ°': 'Ğ¢Ğ¾Ğ»ÑÑ‚Ğ¾Ğ²ĞºĞ°',
                    'ÑĞ²Ğ¸Ñ‚ÑˆĞ¾Ñ‚Ñ‹': 'Ğ¡Ğ²Ğ¸Ñ‚ÑˆĞ¾Ñ‚', 'ÑĞ²Ğ¸Ñ‚ÑˆĞ¾Ñ‚': 'Ğ¡Ğ²Ğ¸Ñ‚ÑˆĞ¾Ñ‚',
                    'Ğ¼Ğ°Ğ¹ĞºĞ¸': 'ĞœĞ°Ğ¹ĞºĞ°', 'Ğ¼Ğ°Ğ¹ĞºĞ°': 'ĞœĞ°Ğ¹ĞºĞ°',
                    'Ñ‚Ğ¾Ğ¿Ñ‹': 'Ğ¢Ğ¾Ğ¿', 'Ñ‚Ğ¾Ğ¿': 'Ğ¢Ğ¾Ğ¿',
                    'Ğ¿Ğ¸Ğ¶Ğ°Ğ¼Ñ‹': 'ĞŸĞ¸Ğ¶Ğ°Ğ¼Ğ°', 'Ğ¿Ğ¸Ğ¶Ğ°Ğ¼Ğ°': 'ĞŸĞ¸Ğ¶Ğ°Ğ¼Ğ°',
                    'Ñ…Ğ°Ğ»Ğ°Ñ‚Ñ‹': 'Ğ¥Ğ°Ğ»Ğ°Ñ‚', 'Ñ…Ğ°Ğ»Ğ°Ñ‚': 'Ğ¥Ğ°Ğ»Ğ°Ñ‚',
                    'ĞºÑƒÑ€Ñ‚ĞºĞ¸': 'ĞšÑƒÑ€Ñ‚ĞºĞ°', 'ĞºÑƒÑ€Ñ‚ĞºĞ°': 'ĞšÑƒÑ€Ñ‚ĞºĞ°',
                    'Ğ¶Ğ¸Ğ»ĞµÑ‚Ñ‹': 'Ğ–Ğ¸Ğ»ĞµÑ‚', 'Ğ¶Ğ¸Ğ»ĞµÑ‚': 'Ğ–Ğ¸Ğ»ĞµÑ‚',
                    'ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½ĞµĞ·Ğ¾Ğ½Ñ‹': 'ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½ĞµĞ·Ğ¾Ğ½', 'ĞºĞ¾Ğ¼Ğ±Ğ¸Ğ½ĞµĞ·Ğ¾Ğ½': 'ĞšĞ¾Ğ¼Ğ±Ğ¸Ğ½ĞµĞ·Ğ¾Ğ½',
                    'ĞºĞ°Ñ€Ğ´Ğ¸Ğ³Ğ°Ğ½Ñ‹': 'ĞšĞ°Ñ€Ğ´Ğ¸Ğ³Ğ°Ğ½', 'ĞºĞ°Ñ€Ğ´Ğ¸Ğ³Ğ°Ğ½': 'ĞšĞ°Ñ€Ğ´Ğ¸Ğ³Ğ°Ğ½',
                    'Ğ±Ğ¾Ğ´Ğ¸': 'Ğ‘Ğ¾Ğ´Ğ¸',
                    'Ñ‚ÑƒĞ½Ğ¸ĞºĞ¸': 'Ğ¢ÑƒĞ½Ğ¸ĞºĞ°', 'Ñ‚ÑƒĞ½Ğ¸ĞºĞ°': 'Ğ¢ÑƒĞ½Ğ¸ĞºĞ°',
                    'Ğ¿Ğ°Ğ»ÑŒÑ‚Ğ¾': 'ĞŸĞ°Ğ»ÑŒÑ‚Ğ¾',
                    'Ğ±Ñ€ÑĞºĞ¸': 'Ğ‘Ñ€ÑĞºĞ¸', // Ä°stisna: Hep Ã§oÄŸul
                    'ÑˆĞ¾Ñ€Ñ‚Ñ‹': 'Ğ¨Ğ¾Ñ€Ñ‚Ñ‹', // Ä°stisna: Hep Ã§oÄŸul
                    'Ğ´Ğ¶Ğ¸Ğ½ÑÑ‹': 'Ğ”Ğ¶Ğ¸Ğ½ÑÑ‹', // Ä°stisna: Hep Ã§oÄŸul
                    'Ğ»ĞµĞ³Ğ³Ğ¸Ğ½ÑÑ‹': 'Ğ›ĞµĞ³Ğ³Ğ¸Ğ½ÑÑ‹', // Ä°stisna: Hep Ã§oÄŸul
                    'Ğ»Ğ¾ÑĞ¸Ğ½Ñ‹': 'Ğ›Ğ¾ÑĞ¸Ğ½Ñ‹', // Ä°stisna: Hep Ã§oÄŸul
                    'Ñ‚Ñ€ÑƒÑÑ‹': 'Ğ¢Ñ€ÑƒÑÑ‹', // Ä°stisna: Hep Ã§oÄŸul
                    'ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚Ñ‹': 'ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚', 'ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚': 'ĞšĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚'
                };

                // 2. Silinecek "GÃ¼rÃ¼ltÃ¼" Kelimeleri (Regex)
                this.yasakliKelimeler = [
                    /ĞºÑ€ÑƒĞ³Ğ»Ñ‹Ğ¹\s*Ğ²Ñ‹Ñ€ĞµĞ·/gi, /v-Ğ¾Ğ±Ñ€Ğ°Ğ·Ğ½[Ğ°-Ñ]*\s*Ğ²Ñ‹Ñ€ĞµĞ·[Ğ°-Ñ]*/gi, /Ğ²Ñ‹Ñ€ĞµĞ·[Ğ°-Ñ]*/gi,
                    /Ğ²Ğ¾Ñ€Ğ¾Ñ‚Ğ½Ğ¸Ğº[Ğ°-Ñ]*/gi, /Ğ¾Ñ‚Ğ»Ğ¾Ğ¶Ğ½Ğ¾Ğ¹/gi, /ÑÑ‚Ğ¾Ğ¹ĞºĞ°/gi,
                    /Ñ\s*Ğ´Ğ»Ğ¸Ğ½Ğ½Ñ‹Ğ¼\s*Ñ€ÑƒĞºĞ°Ğ²Ğ¾Ğ¼/gi, /Ñ\s*ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¼\s*Ñ€ÑƒĞºĞ°Ğ²Ğ¾Ğ¼/gi, /Ñ€ÑƒĞºĞ°Ğ²[Ğ°-Ñ]*/gi, /Ğ±ĞµĞ·\s*Ñ€ÑƒĞºĞ°Ğ²Ğ¾Ğ²/gi,
                    /ÑÑ‚Ğ°Ğ½Ğ´Ğ°Ñ€Ñ‚Ğ½[Ğ°-Ñ]*\s*ĞºÑ€Ğ¾[ÑĞ¹]/gi, /ÑĞ²Ğ¾Ğ±Ğ¾Ğ´Ğ½[Ğ°-Ñ]*\s*ĞºÑ€Ğ¾[ÑĞ¹]/gi, /Ğ¿Ñ€Ğ¸Ñ‚Ğ°Ğ»ĞµĞ½Ğ½[Ğ°-Ñ]*/gi, /Ğ¾Ğ²ĞµÑ€ÑĞ°Ğ¹Ğ·/gi,
                    /Ğ¸Ğ·\s*Ñ…Ğ»Ğ¾Ğ¿ĞºĞ°/gi, /Ğ¸Ğ·\s*Ñ‚Ñ€Ğ¸ĞºĞ¾Ñ‚Ğ°Ğ¶Ğ°/gi, /Ğ¸Ğ·\s*Ğ²Ğ¸ÑĞºĞ¾Ğ·Ñ‹/gi, /Ñ…Ğ»Ğ¾Ğ¿ĞºĞ¾Ğ²[Ğ°-Ñ]*/gi, /Ñ‚Ñ€Ğ¸ĞºĞ¾Ñ‚Ğ°Ğ¶Ğ½[Ğ°-Ñ]*/gi,
                    /Ğ±Ğ°Ğ·Ğ¾Ğ²[Ğ°-Ñ]*/gi, /Ğ¿Ğ¾Ğ²ÑĞµĞ´Ğ½ĞµĞ²Ğ½[Ğ°-Ñ]*/gi, /Ğ½Ğ°Ñ€ÑĞ´Ğ½[Ğ°-Ñ]*/gi,
                    /(\d+)\s*(ÑˆÑ‚|ÑƒĞ¿Ğ°ĞºĞ¾Ğ²[Ğ°-Ñ]*|Ğ¿Ğ°Ñ€[Ğ°-Ñ]*|Ğ½Ğ°Ğ±Ğ¾Ñ€[Ğ°-Ñ]*)/gi, // 2 ÑˆÑ‚, 3 ÑƒĞ¿Ğ°ĞºĞ¾Ğ²ĞºĞ¸ sil
                    /ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑ‚\s*Ğ¸Ğ·\s*\d+.*/gi, // "komplekt iz 3..." sil
                    /\s\d+\s*$/ // Sondaki tek rakamlar (Ã¶rn: "TiÅŸÃ¶rt 2")
                ];

                // 3. Hedef Kitle DÃ¶nÃ¼ÅŸÃ¼mleri
                this.hedefKitle = [
                    { p: /Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½[Ğ°Ñ‹]/gi, r: 'Ğ´Ğ»Ñ Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½' },
                    { p: /Ğ¼ÑƒĞ¶Ñ‡Ğ¸Ğ½[Ğ°Ñ‹]/gi, r: 'Ğ´Ğ»Ñ Ğ¼ÑƒĞ¶Ñ‡Ğ¸Ğ½' },
                    { p: /Ğ´ĞµĞ²Ğ¾Ñ‡[Ğ°-Ñ]*/gi, r: 'Ğ´Ğ»Ñ Ğ´ĞµĞ²Ğ¾Ñ‡ĞµĞº' },
                    { p: /Ğ¼Ğ°Ğ»ÑŒÑ‡Ğ¸[Ğ°-Ñ]*/gi, r: 'Ğ´Ğ»Ñ Ğ¼Ğ°Ğ»ÑŒÑ‡Ğ¸ĞºĞ¾Ğ²' },
                    { p: /Ğ¶ĞµĞ½ÑĞº[Ğ°-Ñ]*/gi, r: 'Ğ´Ğ»Ñ Ğ¶ĞµĞ½Ñ‰Ğ¸Ğ½' },
                    { p: /Ğ¼ÑƒĞ¶ÑĞº[Ğ°-Ñ]*/gi, r: 'Ğ´Ğ»Ñ Ğ¼ÑƒĞ¶Ñ‡Ğ¸Ğ½' },
                    { p: /Ğ´ĞµÑ‚ÑĞº[Ğ°-Ñ]*/gi, r: 'Ğ´Ğ»Ñ Ğ´ĞµÑ‚ĞµĞ¹' },
                    { p: /Ğ¼Ğ°Ğ»Ñ‹Ñˆ[Ğ°-Ñ]*/gi, r: 'Ğ´Ğ»Ñ Ğ¼Ğ°Ğ»Ñ‹ÑˆĞµĞ¹' }
                ];
            }

            temizleVeDuzenle(baslik) {
                if (!baslik) return "";
                let orjinal = String(baslik);
                let islenen = orjinal;

                // A. Noktalama TemizliÄŸi
                islenen = islenen.replace(/[:;,\.\-\/\+\(\)]/g, " ");

                // B. YasaklÄ± Kelime TemizliÄŸi (Ã–nce bunlarÄ± at ki ana Ã¼rÃ¼n ortaya Ã§Ä±ksÄ±n)
                this.yasakliKelimeler.forEach(regex => {
                    islenen = islenen.replace(regex, " ");
                });

                // C. Kelimeleri Analiz Et (Tekil/Ã‡oÄŸul ve ÃœrÃ¼n Bulma)
                let kelimeler = islenen.split(/\s+/).filter(k => k.length > 0);
                let anaUrun = "";
                let hedefKitleStr = "";
                let digerKelimeler = [];

                kelimeler.forEach(kelime => {
                    let kucuk = kelime.toLowerCase();
                    
                    // 1. Hedef Kitle mi?
                    let kitleBulundu = false;
                    for (let hk of this.hedefKitle) {
                        if (hk.p.test(kelime)) {
                            hedefKitleStr = hk.r; // Standart formatÄ± al
                            kitleBulundu = true;
                            break;
                        }
                    }
                    if (kitleBulundu) return;

                    // 2. Ana ÃœrÃ¼n mÃ¼? (SÃ¶zlÃ¼kten kontrol)
                    // Basit stemming: son harfi atÄ±p bak (RusÃ§a ekler iÃ§in basit Ã¶nlem)
                    if (this.urunSozlugu[kucuk]) {
                        // EÄŸer daha Ã¶nce ana Ã¼rÃ¼n bulmadÄ±ysak bunu al
                        // Veya "Elbise" gibi gÃ¼Ã§lÃ¼ bir kelimeyse Ã¶ncelik ver
                        if (!anaUrun || kucuk.length > anaUrun.length) {
                            if (anaUrun) digerKelimeler.push(anaUrun); // Eskisini diÄŸerlerine at
                            anaUrun = this.urunSozlugu[kucuk]; // DoÄŸru halini (Tekil/Ã‡oÄŸul) al
                            return;
                        }
                    }

                    // 3. HiÃ§biri deÄŸilse sÄ±fat/detaydÄ±r
                    // EÄŸer rakam deÄŸilse ekle
                    if (!/^\d+$/.test(kelime)) {
                        digerKelimeler.push(kelime);
                    }
                });

                // D. BaÅŸlÄ±ÄŸÄ± Yeniden Ä°nÅŸa Et (YÃ–NETÄ°CÄ° FORMATI)
                // SÄ±ra: [ANA ÃœRÃœN] + [HEDEF KÄ°TLE] + [DÄ°ÄERLERÄ°]
                
                let yeniBaslikParcalari = [];

                if (anaUrun) {
                    yeniBaslikParcalari.push(anaUrun);
                } else if (digerKelimeler.length > 0) {
                    // Ana Ã¼rÃ¼n bulamadÄ±ysak en baÅŸtaki kelimeyi baÅŸ harfi bÃ¼yÃ¼k yapÄ±p koy
                    let ilk = digerKelimeler.shift();
                    ilk = ilk[0].toUpperCase() + ilk.slice(1).toLowerCase();
                    yeniBaslikParcalari.push(ilk);
                }

                if (hedefKitleStr) {
                    yeniBaslikParcalari.push(hedefKitleStr);
                }

                // Kalan kelimeleri ekle (Ä°lk harfleri kÃ¼Ã§Ã¼k olsun, cÃ¼mle akÄ±ÅŸÄ± iÃ§in)
                digerKelimeler.forEach(k => {
                    // Marka isimleri veya Ã¶zel isimler hariÃ§ kÃ¼Ã§Ã¼k harf
                    if (k === k.toUpperCase()) yeniBaslikParcalari.push(k); // HEPSÄ° BÃœYÃœKSE KORU
                    else yeniBaslikParcalari.push(k.toLowerCase());
                });

                let sonuc = yeniBaslikParcalari.join(" ").trim();

                // E. Son RÃ¶tuÅŸlar ve SÄ±nÄ±rlama
                sonuc = sonuc.replace(/\s+/g, " "); // Ã‡ift boÅŸluklarÄ± sil
                
                if (sonuc.length > 60) {
                    sonuc = sonuc.substring(0, 60);
                    let sonBosluk = sonuc.lastIndexOf(" ");
                    if (sonBosluk > 0) sonuc = sonuc.substring(0, sonBosluk);
                }

                return sonuc;
            }
        }

        // --- UI Ä°ÅŸlemleri ---
        const cleaner = new WBManagerCleaner();
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        uploadArea.onclick = () => fileInput.click();
        
        uploadArea.ondragover = (e) => { e.preventDefault(); uploadArea.style.borderColor = '#48bb78'; };
        uploadArea.ondragleave = () => { uploadArea.style.borderColor = '#cbd5e0'; };
        uploadArea.ondrop = (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#cbd5e0';
            if(e.dataTransfer.files[0]) processFile(e.dataTransfer.files[0]);
        };

        fileInput.onchange = (e) => { if(e.target.files[0]) processFile(e.target.files[0]); };

        let resultWorkbook = null;

        function processFile(file) {
            document.getElementById('progressContainer').style.display = 'block';
            document.getElementById('resultArea').style.display = 'none';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                const sheet = workbook.Sheets[workbook.SheetNames[0]];
                const json = XLSX.utils.sheet_to_json(sheet, {header: 1});

                // Ä°ÅŸlem BaÅŸlÄ±yor
                const headers = json[0];
                const outputData = [ [...headers, "WB_Final_Baslik"] ];
                
                // Ä°sim sÃ¼tununu bul
                let nameIndex = headers.findIndex(h => h && /name|isim|Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ/i.test(h));
                if (nameIndex === -1) nameIndex = 0; // Bulamazsa ilk sÃ¼tun

                let totalRows = json.length;

                for(let i=1; i < totalRows; i++) {
                    const row = json[i];
                    const rawTitle = row[nameIndex];
                    const cleanTitle = cleaner.temizleVeDuzenle(rawTitle);
                    
                    const newRow = [...row];
                    newRow.push(cleanTitle); // Sona ekle
                    outputData.push(newRow);

                    // Progress
                    if (i % 50 === 0) {
                        let pct = Math.round((i / totalRows) * 100);
                        document.getElementById('progressFill').style.width = pct + "%";
                        document.getElementById('progressText').innerText = pct + "%";
                    }
                }

                // TamamlandÄ±
                document.getElementById('progressFill').style.width = "100%";
                document.getElementById('progressText').innerText = "100%";

                // SonuÃ§larÄ± HazÄ±rla
                const newSheet = XLSX.utils.aoa_to_sheet(outputData);
                resultWorkbook = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(resultWorkbook, newSheet, "WB_Cleaned");

                showPreview(outputData);
                document.getElementById('resultArea').style.display = 'block';
            };
            reader.readAsArrayBuffer(file);
        }

        function showPreview(data) {
            let html = '<table class="preview-table"><thead><tr><th>Orjinal</th><th>WB DÃ¼zenlenmiÅŸ (YÃ¶netici FormatÄ±)</th></tr></thead><tbody>';
            // Ä°sim sÃ¼tunu ve son sÃ¼tunu al
            let nameIdx = data[0].findIndex(h => h && /name|isim|Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ/i.test(h));
            if(nameIdx === -1) nameIdx = 0;

            // Ä°lk 10 satÄ±rÄ± gÃ¶ster
            for(let i=1; i < Math.min(data.length, 11); i++) {
                html += `<tr><td>${data[i][nameIdx] || ''}</td><td style="color:#2a5298; font-weight:bold;">${data[i][data[i].length-1]}</td></tr>`;
            }
            html += '</tbody></table>';
            document.getElementById('previewContainer').innerHTML = html;
        }

        document.getElementById('downloadBtn').onclick = () => {
            if(resultWorkbook) XLSX.writeFile(resultWorkbook, "WB_Yonetici_Formatli_Urunler.xlsx");
        };
    </script>
</body>
</html>
