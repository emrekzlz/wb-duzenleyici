<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WB Ba≈ülƒ±k D√ºzenleyici v3.1</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #0051A5 0%, #003D7A 100%); min-height: 100vh; padding: 40px 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { background: #fff; padding: 40px; border-radius: 20px 20px 0 0; box-shadow: 0 4px 20px rgba(0,0,0,.15); text-align: center; }
    .logo-text { font-size: 3em; font-weight: 900; color: #0051A5; letter-spacing: -2px; margin-bottom: 20px; }
    .header h1 { color: #0051A5; font-size: 2.2em; font-weight: 700; margin-bottom: 10px; }
    .subtitle { color: #666; font-size: 1.1em; margin-bottom: 20px; }
    .version-badge { display: inline-block; background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 8px 20px; border-radius: 25px; font-size: .85em; font-weight: 600; }
    .main-content { background: #fff; padding: 50px 40px; border-radius: 0 0 20px 20px; box-shadow: 0 4px 20px rgba(0,0,0,.15); }
    .upload-area { border: 3px dashed #0051A5; border-radius: 15px; padding: 80px 40px; text-align: center; background: linear-gradient(135deg, #f8f9ff, #e8f0ff); cursor: pointer; transition: all .3s; }
    .upload-area:hover { border-color: #003D7A; transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,81,165,.2); }
    .upload-area.dragover { background: linear-gradient(135deg, #e8f0ff, #d0e4ff); transform: scale(1.02); }
    .upload-icon { font-size: 5em; margin-bottom: 20px; }
    .upload-text { font-size: 1.4em; color: #0051A5; font-weight: 600; margin-bottom: 15px; }
    .upload-hint { color: #666; }
    input[type="file"] { display: none; }
    .progress-container { display: none; margin: 40px 0; }
    .progress-bar { width: 100%; height: 35px; background: #e8f0ff; border-radius: 20px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #0051A5, #003D7A); width: 0%; transition: width .3s; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 1.1em; }
    .result-area { display: none; margin-top: 40px; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px; }
    .stat-card { background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 35px 30px; border-radius: 15px; text-align: center; box-shadow: 0 8px 20px rgba(0,81,165,.3); transition: transform .3s; }
    .stat-card:hover { transform: translateY(-5px); }
    .stat-number { font-size: 3em; font-weight: 800; margin-bottom: 10px; }
    .stat-label { font-size: 1em; opacity: .95; }
    .download-btn { display: inline-block; background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 18px 50px; border-radius: 12px; font-weight: 800; font-size: 1.2em; cursor: pointer; border: none; transition: all .3s; box-shadow: 0 6px 20px rgba(0,81,165,.3); }
    .download-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,81,165,.4); }
    .preview-table { width: 100%; margin-top: 40px; border-collapse: collapse; background: #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,.1); }
    .preview-table th { background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 18px; text-align: left; font-weight: 700; }
    .preview-table td { padding: 15px 18px; border-bottom: 1px solid #e8f0ff; }
    .preview-table tr:hover { background: #f8f9ff; }
    .preview-title { color: #0051A5; font-size: 1.5em; font-weight: 700; margin-top: 50px; margin-bottom: 20px; }
    .footer { text-align: center; margin-top: 30px; color: #fff; font-size: .9em; opacity: .9; }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="logo-text">LC Waikiki</div>
      <h1>Wildberries Ba≈ülƒ±k D√ºzenleyici</h1>
      <p class="subtitle">Kategori stili kƒ±sa isim √ºretir</p>
      <span class="version-badge">v3.1 (Y√∂netici Stili)</span>
    </div>

    <div class="main-content">
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìä</div>
        <div class="upload-text">Excel dosyanƒ±zƒ± buraya s√ºr√ºkleyin</div>
        <div class="upload-hint">veya tƒ±klayarak dosya se√ßin (.xlsx, .xls)</div>
        <input type="file" id="fileInput" accept=".xlsx,.xls" />
      </div>

      <div class="progress-container" id="progressContainer">
        <div class="progress-bar"><div class="progress-fill" id="progressFill">0%</div></div>
      </div>

      <div class="result-area" id="resultArea">
        <div class="stats">
          <div class="stat-card"><div class="stat-number" id="totalRows">0</div><div class="stat-label">Toplam Satƒ±r</div></div>
          <div class="stat-card"><div class="stat-number" id="totalColumns">0</div><div class="stat-label">ƒ∞≈ülenen S√ºtun</div></div>
          <div class="stat-card"><div class="stat-number" id="processTime">0s</div><div class="stat-label">ƒ∞≈ülem S√ºresi</div></div>
        </div>

        <div style="text-align:center;margin:40px 0;">
          <button class="download-btn" id="downloadBtn">üì• D√ºzenlenmi≈ü Dosyayƒ± ƒ∞ndir</button>
        </div>

        <div id="previewContainer"></div>
      </div>
    </div>

    <div class="footer">¬© 2026 - WB Ba≈ülƒ±k D√ºzenleyici</div>
  </div>

<script>
class WBBaslikDuzenleyici {
  constructor(options = {}) {
    this.opts = {
      maxLen: 60,
      includeQuantity: false,
      maxFeatures: 2,
      ...options
    };

    // Tekil/yapay hedef kitle -> –¥–ª—è ...
    this.hedefKitleDonusumleri = [
      { re: /\b–ñ–µ–Ω—â–∏–Ω–∞\b/gi, out: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
      { re: /\b–ú—É–∂—á–∏–Ω–∞\b/gi, out: "–¥–ª—è –º—É–∂—á–∏–Ω" },
      { re: /\b–î–µ–≤—É—à–∫–∞\b/gi, out: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
      { re: /\b–î–µ–≤–æ—á–∫–∞\b/gi, out: "–¥–ª—è –¥–µ–≤–æ—á–µ–∫" },
      { re: /\b–ú–∞–ª—å—á–∏–∫\b/gi, out: "–¥–ª—è –º–∞–ª—å—á–∏–∫–æ–≤" },

      { re: /\b–ñ–µ–Ω—Å–∫(–∏–π|–∞—è|–æ–µ)\b/gi, out: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
      { re: /\b–ú—É–∂—Å–∫(–æ–π|–∞—è|–æ–µ)\b/gi, out: "–¥–ª—è –º—É–∂—á–∏–Ω" },
    ];

    // Y√∂netici stilindeki √ºr√ºn tipi (prefer edilen yazƒ±m: √ßoƒüu zaman √ßoƒüul)
    // Not: Burayƒ± geni≈ületebilirsin; genel √ßalƒ±≈üƒ±r.
    this.productTypes = [
      { re: /\b–∫–æ–º–±–∏–Ω–µ–∑–æ–Ω(—ã)?\b/i, out: "–ö–æ–º–±–∏–Ω–µ–∑–æ–Ω—ã" },
      { re: /\b–ø–∏–∂–∞–º–Ω(—ã–π|—ã–µ)\s+–∫–æ–º–ø–ª–µ–∫—Ç(—ã)?\b/i, out: "–ü–∏–∂–∞–º–Ω—ã–µ –∫–æ–º–ø–ª–µ–∫—Ç—ã" },
      { re: /\b–∫–æ–º–ø–ª–µ–∫—Ç(—ã)?\b/i, out: "–ö–æ–º–ø–ª–µ–∫—Ç—ã" },
      { re: /\b—Ä—É–±–∞—à–∫(–∞|–∏)\b/i, out: "–†—É–±–∞—à–∫–∏" },
      { re: /\b–ø–∞–ª—å—Ç–æ\b/i, out: "–ü–∞–ª—å—Ç–æ" },
      { re: /\b–¥–∂–æ–≥–≥–µ—Ä(—ã)?\b/i, out: "–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–µ –¥–∂–æ–≥–≥–µ—Ä—ã" }, // √ßoƒüu listede b√∂yle ge√ßiyor
      { re: /\b—à–æ—Ä—Ç(—ã)?\b/i, out: "–®–æ—Ä—Ç—ã" },
      { re: /\b–±—Ä—é–∫(–∏)?\b/i, out: "–ë—Ä—é–∫–∏" },
      { re: /\b–¥–∂–∏–Ω—Å(—ã)?\b/i, out: "–î–∂–∏–Ω—Å—ã" },
      { re: /\b—Ç—Ä—É—Å(—ã)?\b/i, out: "–¢—Ä—É—Å—ã" },
      { re: /\b–Ω–æ—Å–∫(–∏)?\b/i, out: "–ù–æ—Å–∫–∏" },
      { re: /\b–∫—É–ø–∞–ª—å–Ω–∏–∫(–∏)?\b/i, out: "–ö—É–ø–∞–ª—å–Ω–∏–∫–∏" },
      { re: /\b—Ñ—É—Ç–±–æ–ª–∫(–∞|–∏)\b/i, out: "–§—É—Ç–±–æ–ª–∫–∞" }, // bazen tekil bƒ±rakƒ±yor
      { re: /\b—Å–≤–∏—Ç—à–æ—Ç(—ã)?\b/i, out: "–°–≤–∏—Ç—à–æ—Ç" },
      { re: /\b—Å–≤–∏—Ç–µ—Ä(—ã)?\b/i, out: "–¢—Ä–∏–∫–æ—Ç–∞–∂–Ω—ã–π —Å–≤–∏—Ç–µ—Ä" },
      { re: /\b—Ç—É–Ω–∏–∫(–∞|–∏)\b/i, out: "–¢—É–Ω–∏–∫–∞" },
      { re: /\b–∫—Ä–æ—Å—Å–æ–≤–∫(–∏)?\b/i, out: "–ö—Ä–æ—Å—Å–æ–≤–∫–∏" },
      { re: /\b—Å–∞–Ω–¥–∞–ª(–∏|–∏–∏|–∏—è)\b/i, out: "–°–∞–Ω–¥–∞–ª–∏–∏" },
      { re: /\b–±–æ—Ç–∏–Ω–∫(–∏|–∞)\b/i, out: "–ë–æ—Ç–∏–Ω–∫–∏" },
      { re: /\b—Å–∞–ø–æ–≥(–∏|–∞)\b/i, out: "–°–∞–ø–æ–≥–∏" },
      { re: /\b—Ç—É—Ñ–ª(–∏|—è)\b/i, out: "–¢—É—Ñ–ª–∏" },
      { re: /\b–ª–æ—Ñ–µ—Ä(—ã)?\b/i, out: "–õ–æ—Ñ–µ—Ä—ã" },
      { re: /\b–±–∞–ª–µ—Ç–∫(–∏|–∞)\b/i, out: "–ë–∞–ª–µ—Ç–∫–∏" },
      { re: /\b–±—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä[- ]?—Ñ—É—Ç–±–æ–ª–∫–∞\b/i, out: "–ë—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä-—Ñ—É—Ç–±–æ–ª–∫–∞" },
      { re: /\b–±—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä(—ã)?\b/i, out: "–ë—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä—ã" },
    ];

    // Default/istenmeyen √∂zellikler (y√∂netici genelde yazmƒ±yor)
    this.dropPhrases = [
      /\b–∫—Ä—É–≥–ª(—ã–π|—ã–º)\s+–≤—ã—Ä–µ–∑(–æ–º)?\b/gi, // genelde at
      /\b–æ–¥–Ω–æ—Ç–æ–Ω–Ω(—ã–π|–∞—è|–æ–µ|—ã–µ)\b/gi,     // √ßoƒüu listede atƒ±labiliyor
    ];

    // √ñnemli √∂zellikler (1-2 tane se√ßilecek) ‚Äî y√∂netici dili
    this.featureRules = [
      { re: /\b—Å\s+–ª–∏–ø—É—á–∫(–∞–º–∏|–æ–π)\b/gi, out: "—Å –ª–∏–ø—É—á–∫–∞–º–∏", score: 100 },
      { re: /\b—Å\s+–ø–æ–¥—Å–≤–µ—Ç–∫(–æ–π|–∞–º–∏)\b/gi, out: "—Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π", score: 100 },
      { re: /\b–Ω–∞\s+—à–Ω—É—Ä–∫(–∞—Ö|–∞—Ö)\b/gi, out: "–Ω–∞ —à–Ω—É—Ä–∫–∞—Ö", score: 95 },
      { re: /\b—Å\s+–º–æ–ª–Ω–∏(–µ–π|–µ–π)\b/gi, out: "—Å –º–æ–ª–Ω–∏–µ–π", score: 95 },
      { re: /\b—Å\s+–∫–∞–ø—é—à–æ–Ω(–æ–º|–æ–º)\b/gi, out: "—Å –∫–∞–ø—é—à–æ–Ω–æ–º", score: 90 },
      { re: /\b—Å\s+–ø—Ä–∏–Ω—Ç(–æ–º|–æ–º)\b/gi, out: "—Å –ø—Ä–∏–Ω—Ç–æ–º", score: 85 },
      { re: /\b–≤\s+–ø–æ–ª–æ—Å–∫(—É|–∫—É)\b/gi, out: "–≤ –ø–æ–ª–æ—Å–∫—É", score: 85 },
      { re: /\b–≤\s+–∫–ª–µ—Ç–∫(—É|–∫—É)\b/gi, out: "–≤ –∫–ª–µ—Ç–∫—É", score: 85 },
      { re: /\b—Å\s+–¥–ª–∏–Ω–Ω(—ã–º|—ã–º–∏)\s+—Ä—É–∫–∞–≤(–æ–º|–∞–º–∏)\b/gi, out: "—Å –¥–ª–∏–Ω–Ω—ã–º —Ä—É–∫–∞–≤–æ–º", score: 80 },
      { re: /\b—Å\s+–∫–æ—Ä–æ—Ç–∫(–∏–º|–∏–º–∏)\s+—Ä—É–∫–∞–≤(–æ–º|–∞–º–∏)\b/gi, out: "—Å –∫–æ—Ä–æ—Ç–∫–∏–º —Ä—É–∫–∞–≤–æ–º", score: 80 },
      { re: /\b—Å\s+V[- ]?–≤—ã—Ä–µ–∑(–æ–º)?\b/gi, out: "—Å V –≤—ã—Ä–µ–∑–æ–º", score: 80 },
      { re: /\b—Å\s+–∫–≤–∞–¥—Ä–∞—Ç–Ω(—ã–º|—ã–º)\s+–≤—ã—Ä–µ–∑(–æ–º)?\b/gi, out: "—Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º –≤—ã—Ä–µ–∑–æ–º", score: 80 },
      { re: /\b—Å\s+—ç–ª–∞—Å—Ç–∏—á–Ω(–æ–π|—ã–º)\s+—Ç–∞–ª(–∏–µ–π|–∏–µ–π)\b/gi, out: "—Å —ç–ª–∞—Å—Ç–∏—á–Ω–æ–π —Ç–∞–ª–∏–µ–π", score: 75 },
      { re: /\b—Å\s+—ç–ª–∞—Å—Ç–∏—á–Ω(—ã–º|—ã–º)\s+–ø–æ—è—Å(–æ–º|–æ–º)\b/gi, out: "—Å —ç–ª–∞—Å—Ç–∏—á–Ω—ã–º –ø–æ—è—Å–æ–º", score: 75 },
      { re: /\b—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω(–æ–≥–æ|—ã–π)\s+–∫—Ä–æ—è\b/gi, out: "—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∫—Ä–æ—è", score: 70 },
      { re: /\b—Å–≤–æ–±–æ–¥–Ω(–æ–≥–æ|—ã–π)\s+–∫—Ä–æ—è\b/gi, out: "—Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –∫—Ä–æ—è", score: 70 },
      { re: /\b–æ–≤–µ—Ä—Å–∞–π–∑\b/gi, out: "–æ–≤–µ—Ä—Å–∞–π–∑", score: 65 },
      { re: /\b—Å\s+–∑–∞—â–∏—Ç(–æ–π|–æ–π)\s+–æ—Ç\s+—É–ª—å—Ç—Ä–∞—Ñ–∏–æ–ª–µ—Ç(–∞)?\b/gi, out: "—Å UV –∑–∞—â–∏—Ç–æ–π", score: 90 },
    ];

    // Materyal: "–∏–∑ ...."
    this.materialRe = /\b–∏–∑\s+[^,]+/i;

    this.yasakSonKelimeler = new Set([
      "—Å","—Å–æ","–∏–∑","–æ—Ç","–¥–æ","–±–µ–∑","–¥–ª—è","–∫","–∫–æ","–æ","–æ–±","–æ–±–æ","—É","–≤","–≤–æ","–Ω–∞","–∑–∞","–ø–æ","–ø–æ–¥","–Ω–∞–¥","–∏","–∏–ª–∏","–∞","–Ω–æ","—á—Ç–æ","–∫–∞–∫"
    ]);
  }

  cleanSpaces(t){ return String(t||"").replace(/\s+/g," ").trim(); }

  cleanPunct(t){
    return String(t||"")
      .replace(/[‚Äì‚Äî]/g, "-")
      .replace(/\s*[,;:]+/g, ",")
      .replace(/\s*,\s*/g, ", ")
      .replace(/\s*-\s*/g, " ")
      .replace(/\s+/g, " ")
      .trim();
  }

  stripTrailingPunct(t){ return t.replace(/[,\.;:\-‚Äì‚Äî]+$/g,"").trim(); }

  stripTrailingStopWords(t){
    let parts = this.cleanSpaces(t).split(" ").filter(Boolean);
    while(parts.length){
      let last = parts[parts.length-1].toLowerCase().replace(/[.,;:]+$/g,"");
      if(this.yasakSonKelimeler.has(last)) parts.pop();
      else break;
    }
    return parts.join(" ").trim();
  }

  removeQuantity(t){
    return this.cleanSpaces(t)
      .replace(/[, ]*\b\d{1,3}\s*(—É–ø–∞–∫–æ–≤–∫(–∏|–∞)?|—É–ø\.?)\b/gi,"")
      .replace(/[, ]*\b\d{1,3}\s*—à—Ç\.?\b/gi,"")
      .replace(/[, ]*\b\d{1,3}\s*(pcs|pc)\b/gi,"")
      .replace(/[, ]*\b\d{1,3}\b\s*$/g,"")
      .trim();
  }

  targetNormalize(t){
    let out = t;
    for(const r of this.hedefKitleDonusumleri){
      out = out.replace(r.re, r.out);
    }
    // tekrar eden "–¥–ª—è ..."
    out = out.replace(/\b–¥–ª—è\s+(–∂–µ–Ω—â–∏–Ω|–º—É–∂—á–∏–Ω|–º–∞–ª—å—á–∏–∫–æ–≤|–¥–µ–≤–æ—á–µ–∫)\b(?:\s+–¥–ª—è\s+\1\b)+/gi, "–¥–ª—è $1");
    return out;
  }

  detectType(t){
    for(const p of this.productTypes){
      if(p.re.test(t)) return p.out;
    }
    return "";
  }

  pickTarget(t){
    const m = t.match(/\b–¥–ª—è\s+(–∂–µ–Ω—â–∏–Ω|–º—É–∂—á–∏–Ω|–¥–µ–≤–æ—á–µ–∫|–º–∞–ª—å—á–∏–∫–æ–≤|–º–∞–ª—ã—à–µ–π\s+–º–∞–ª—å—á–∏–∫–æ–≤|–º–∞–ª—ã—à–µ–∫\s+–¥–µ–≤–æ—á–µ–∫|–Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã—Ö\s+–º–∞–ª—å—á–∏–∫–æ–≤|–Ω–æ–≤–æ—Ä–æ–∂–¥–µ–Ω–Ω—ã—Ö\s+–¥–µ–≤–æ—á–µ–∫)\b/i);
    return m ? ("–¥–ª—è " + m[1].replace(/\s+/g," ").trim()) : "";
  }

  pickMaterial(t){
    const m = t.match(this.materialRe);
    if(!m) return "";
    let s = m[0].trim();
    // √ßok uzamasƒ±n
    if(s.length > 28){
      s = s.slice(0,28);
      s = s.slice(0, s.lastIndexOf(" ")>0 ? s.lastIndexOf(" ") : s.length).trim();
    }
    return s;
  }

  pickFeatures(t){
    const found = [];
    for(const f of this.featureRules){
      if(f.re.test(t)){
        found.push({ out: f.out, score: f.score });
      }
    }
    // uniq + score
    const uniq = new Map();
    for(const x of found){
      const k = x.out.toLowerCase();
      if(!uniq.has(k) || uniq.get(k).score < x.score) uniq.set(k, x);
    }
    const arr = Array.from(uniq.values()).sort((a,b)=>b.score-a.score).slice(0, this.opts.maxFeatures);
    return arr.map(x=>x.out);
  }

  applyDropPhrases(t){
    let out = t;
    for(const re of this.dropPhrases){
      out = out.replace(re, " ");
    }
    return this.cleanSpaces(out);
  }

  // Cyrillic kelimeleri k√º√ß√ºlt, Latin/UV/3D gibi ≈üeyleri bozma
  managerCase(t){
    const tokens = this.cleanSpaces(t).split(" ");
    const out = tokens.map((w, i) => {
      const hasLatinOrDigit = /[A-Z0-9]/.test(w);
      if(hasLatinOrDigit) return w;
      const lower = w.toLowerCase();
      if(i === 0) return lower.charAt(0).toUpperCase() + lower.slice(1);
      return lower;
    });
    return out.join(" ");
  }

  smartTrim(t){
    if(t.length <= this.opts.maxLen) return t;
    let s = t.slice(0, this.opts.maxLen);
    const cut = s.lastIndexOf(" ");
    if(cut > 20) s = s.slice(0, cut).trim();
    s = this.stripTrailingPunct(s);
    s = this.stripTrailingStopWords(s);
    s = this.stripTrailingPunct(s);
    return s;
  }

  duzenle(input){
    if(!input || String(input).trim()==="") return "";

    let t = String(input).trim();
    t = this.cleanPunct(t);
    t = this.targetNormalize(t);

    if(!this.opts.includeQuantity){
      t = this.removeQuantity(t);
    }

    t = this.applyDropPhrases(t);

    const type = this.detectType(t);
    const target = this.pickTarget(t);
    const material = this.pickMaterial(t);
    const features = this.pickFeatures(t);

    // √úr√ºn tipi bulamazsak fallback: ilk 2-3 kelimeyi kullan
    let head = type;
    if(!head){
      const parts = this.cleanSpaces(t).split(" ");
      head = parts.slice(0, Math.min(3, parts.length)).join(" ");
    }

    // Kurulum: Type + features + material + target
    let outParts = [head];

    for(const f of features){
      // "—Å ..." ile ba≈ülayanlar y√∂neticide √ºr√ºn tipinden sonra gelir
      outParts.push(f);
    }
    if(material) outParts.push(material);
    if(target) outParts.push(target);

    let out = this.cleanSpaces(outParts.join(" "));
    out = this.stripTrailingPunct(out);
    out = this.stripTrailingStopWords(out);
    out = this.stripTrailingPunct(out);

    out = this.managerCase(out);
    out = this.smartTrim(out);

    // final g√ºvenlik
    out = this.stripTrailingPunct(out);
    out = this.stripTrailingStopWords(out);
    out = this.stripTrailingPunct(out);
    out = this.managerCase(out);

    return out;
  }
}

// UI
const uploadArea = document.getElementById("uploadArea");
const fileInput = document.getElementById("fileInput");
const progressContainer = document.getElementById("progressContainer");
const progressFill = document.getElementById("progressFill");
const resultArea = document.getElementById("resultArea");
const downloadBtn = document.getElementById("downloadBtn");

let processedWorkbook = null;
let duzenleyici = new WBBaslikDuzenleyici();

function updateProgress(p){
  progressFill.style.width = p + "%";
  progressFill.textContent = Math.round(p) + "%";
}

function escapeHtml(s){
  return String(s)
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;")
    .replace(/'/g,"&#039;");
}

function createPreviewTable(out){
  const header = out[0];
  const preview = out.slice(1, 11);

  let html = '<h3 class="preview-title">√ñnizleme (ƒ∞lk 10 Satƒ±r)</h3>';
  html += '<table class="preview-table"><thead><tr>';
  header.forEach(h => html += `<th>${escapeHtml(h||"")}</th>`);
  html += "</tr></thead><tbody>";

  preview.forEach(row => {
    html += "<tr>";
    header.forEach((_, i) => html += `<td>${escapeHtml(row[i]||"")}</td>`);
    html += "</tr>";
  });

  html += "</tbody></table>";
  document.getElementById("previewContainer").innerHTML = html;
}

function showResults(out, sec, processedCols){
  setTimeout(() => {
    progressContainer.style.display = "none";
    resultArea.style.display = "block";
    document.getElementById("totalRows").textContent = out.length - 1;
    document.getElementById("totalColumns").textContent = processedCols;
    document.getElementById("processTime").textContent = sec + "s";
    createPreviewTable(out);
    resultArea.scrollIntoView({ behavior: "smooth" });
  }, 250);
}

function processFile(file){
  const start = Date.now();
  progressContainer.style.display = "block";
  resultArea.style.display = "none";
  updateProgress(10);

  const reader = new FileReader();
  reader.onload = function(ev){
    try{
      updateProgress(30);
      const data = new Uint8Array(ev.target.result);
      const wb = XLSX.read(data, { type: "array" });
      updateProgress(50);

      const sheetName = wb.SheetNames[0];
      const sheet = wb.Sheets[sheetName];
      const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

      updateProgress(60);

      const headers = rows[0] || [];
      const outHeader = [...headers];

      const titleColIdxs = [];
      headers.forEach((h, idx) => {
        if(!h) return;
        const s = String(h).toLowerCase();
        if(s.includes("isim") || s.includes("–Ω–∞–∑–≤–∞–Ω–∏–µ") || s.includes("name")){
          titleColIdxs.push(idx);
          outHeader.push(String(h) + "_kƒ±sa");
        }
      });

      const out = [outHeader];
      updateProgress(70);

      for(let r=1; r<rows.length; r++){
        const row = rows[r] || [];
        const newRow = [...row];

        for(const idx of titleColIdxs){
          const original = row[idx] || "";
          const edited = duzenleyici.duzenle(original);
          newRow.push(edited);
        }

        out.push(newRow);
        if(r % 200 === 0){
          updateProgress(70 + (r / Math.max(1, rows.length)) * 20);
        }
      }

      updateProgress(95);

      const outSheet = XLSX.utils.aoa_to_sheet(out);
      const outWb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(outWb, outSheet, sheetName);

      processedWorkbook = outWb;
      updateProgress(100);

      const sec = ((Date.now() - start)/1000).toFixed(1);
      showResults(out, sec, titleColIdxs.length);

    }catch(err){
      console.error(err);
      alert("Dosya i≈ülenirken hata olu≈ütu: " + err.message);
      progressContainer.style.display = "none";
    }
  };

  reader.readAsArrayBuffer(file);
}

uploadArea.addEventListener("click", () => fileInput.click());
uploadArea.addEventListener("dragover", (e) => { e.preventDefault(); uploadArea.classList.add("dragover"); });
uploadArea.addEventListener("dragleave", () => uploadArea.classList.remove("dragover"));
uploadArea.addEventListener("drop", (e) => {
  e.preventDefault();
  uploadArea.classList.remove("dragover");
  const file = e.dataTransfer.files[0];
  if(file) processFile(file);
});
fileInput.addEventListener("change", (e) => {
  const file = e.target.files[0];
  if(file) processFile(file);
});

downloadBtn.addEventListener("click", () => {
  if(!processedWorkbook) return;
  const t = new Date().toISOString().slice(0,19).replace(/:/g,"-");
  XLSX.writeFile(processedWorkbook, `WB_LCW_${t}.xlsx`);
});
</script>
</body>
</html>
