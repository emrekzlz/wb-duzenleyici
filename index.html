<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WB BaÅŸlÄ±k DÃ¼zenleyici v2.0 - LC Waikiki</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Arial', sans-serif; background: linear-gradient(135deg, #0051A5 0%, #003D7A 100%); min-height: 100vh; padding: 40px 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { background: white; padding: 40px; border-radius: 20px 20px 0 0; box-shadow: 0 4px 20px rgba(0,0,0,0.15); text-align: center; }
    .logo-text { font-size: 3em; font-weight: 900; color: #0051A5; letter-spacing: -2px; margin-bottom: 20px; }
    .header h1 { color: #0051A5; font-size: 2.2em; font-weight: 700; margin-bottom: 10px; }
    .subtitle { color: #666; font-size: 1.1em; margin-bottom: 20px; }
    .version-badge { display: inline-block; background: linear-gradient(135deg, #0051A5, #003D7A); color: white; padding: 8px 20px; border-radius: 25px; font-size: 0.85em; font-weight: 600; }
    .main-content { background: white; padding: 50px 40px; border-radius: 0 0 20px 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); }
    .upload-area { border: 3px dashed #0051A5; border-radius: 15px; padding: 80px 40px; text-align: center; background: linear-gradient(135deg, #f8f9ff, #e8f0ff); cursor: pointer; transition: all 0.3s; }
    .upload-area:hover { border-color: #003D7A; transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,81,165,0.2); }
    .upload-area.dragover { background: linear-gradient(135deg, #e8f0ff, #d0e4ff); transform: scale(1.02); }
    .upload-icon { font-size: 5em; margin-bottom: 20px; }
    .upload-text { font-size: 1.4em; color: #0051A5; font-weight: 600; margin-bottom: 15px; }
    .upload-hint { color: #666; }
    input[type="file"] { display: none; }
    .progress-container { display: none; margin: 40px 0; }
    .progress-bar { width: 100%; height: 35px; background: #e8f0ff; border-radius: 20px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #0051A5, #003D7A); width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 1.1em; }
    .result-area { display: none; margin-top: 40px; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px; }
    .stat-card { background: linear-gradient(135deg, #0051A5, #003D7A); color: white; padding: 35px 30px; border-radius: 15px; text-align: center; box-shadow: 0 8px 20px rgba(0,81,165,0.3); transition: transform 0.3s; }
    .stat-card:hover { transform: translateY(-5px); }
    .stat-number { font-size: 3em; font-weight: bold; margin-bottom: 10px; }
    .stat-label { font-size: 1em; opacity: 0.95; }
    .download-btn { display: inline-block; background: linear-gradient(135deg, #0051A5, #003D7A); color: white; padding: 18px 50px; border-radius: 12px; font-weight: bold; font-size: 1.2em; cursor: pointer; border: none; transition: all 0.3s; box-shadow: 0 6px 20px rgba(0,81,165,0.3); }
    .download-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,81,165,0.4); }
    .preview-table { width: 100%; margin-top: 40px; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .preview-table th { background: linear-gradient(135deg, #0051A5, #003D7A); color: white; padding: 18px; text-align: left; font-weight: 600; }
    .preview-table td { padding: 15px 18px; border-bottom: 1px solid #e8f0ff; }
    .preview-table tr:hover { background: #f8f9ff; }
    .preview-title { color: #0051A5; font-size: 1.5em; font-weight: 600; margin-top: 50px; margin-bottom: 20px; }
    .footer { text-align: center; margin-top: 30px; color: white; font-size: 0.9em; opacity: 0.9; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="logo-text">LC Waikiki</div>
      <h1>Wildberries BaÅŸlÄ±k DÃ¼zenleyici</h1>
      <p class="subtitle">Profesyonel baÅŸlÄ±k dÃ¼zenleme aracÄ±</p>
      <span class="version-badge">v2.0 Professional</span>
    </div>

    <div class="main-content">
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">ðŸ“Š</div>
        <div class="upload-text">Excel dosyanÄ±zÄ± buraya sÃ¼rÃ¼kleyin</div>
        <div class="upload-hint">veya tÄ±klayarak dosya seÃ§in (.xlsx, .xls)</div>
        <input type="file" id="fileInput" accept=".xlsx,.xls" />
      </div>

      <div class="progress-container" id="progressContainer">
        <div class="progress-bar"><div class="progress-fill" id="progressFill">0%</div></div>
      </div>

      <div class="result-area" id="resultArea">
        <div class="stats">
          <div class="stat-card"><div class="stat-number" id="totalRows">0</div><div class="stat-label">Toplam SatÄ±r</div></div>
          <div class="stat-card"><div class="stat-number" id="totalColumns">0</div><div class="stat-label">Ä°ÅŸlenen SÃ¼tun</div></div>
          <div class="stat-card"><div class="stat-number" id="processTime">0s</div><div class="stat-label">Ä°ÅŸlem SÃ¼resi</div></div>
        </div>

        <div style="text-align:center;margin:40px 0;">
          <button class="download-btn" id="downloadBtn">ðŸ“¥ DÃ¼zenlenmiÅŸ DosyayÄ± Ä°ndir</button>
        </div>

        <div id="previewContainer"></div>
      </div>
    </div>

    <div class="footer">Â© 2026 LC Waikiki - Wildberries BaÅŸlÄ±k DÃ¼zenleyici v2.0</div>
  </div>

  <script>
    class WBBaslikDuzenleyici {
      constructor() {
        this.hedefKitleDonusumleri = [
          { pattern: /\bÐ–ÐµÐ½Ñ‰Ð¸Ð½Ð°\b/gi, replacement: "Ð´Ð»Ñ Ð¶ÐµÐ½Ñ‰Ð¸Ð½" },
          { pattern: /\bÐœÑƒÐ¶Ñ‡Ð¸Ð½Ð°\b/gi, replacement: "Ð´Ð»Ñ Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½" },
          { pattern: /\bÐ”ÐµÐ²ÑƒÑˆÐºÐ°\b/gi, replacement: "Ð´Ð»Ñ Ð¶ÐµÐ½Ñ‰Ð¸Ð½" },
          { pattern: /\bÐ”ÐµÐ²Ð¾Ñ‡ÐºÐ°\b/gi, replacement: "Ð´Ð»Ñ Ð´ÐµÐ²Ð¾Ñ‡ÐµÐº" },
          { pattern: /\bÐœÐ°Ð»ÑŒÑ‡Ð¸Ðº\b/gi, replacement: "Ð´Ð»Ñ Ð¼Ð°Ð»ÑŒÑ‡Ð¸ÐºÐ¾Ð²" },
          { pattern: /\bÐ–ÐµÐ½ÑÐºÐ¸Ð¹\b/gi, replacement: "Ð´Ð»Ñ Ð¶ÐµÐ½Ñ‰Ð¸Ð½" },
          { pattern: /\bÐ–ÐµÐ½ÑÐºÐ°Ñ\b/gi, replacement: "Ð´Ð»Ñ Ð¶ÐµÐ½Ñ‰Ð¸Ð½" },
          { pattern: /\bÐ–ÐµÐ½ÑÐºÐ¾Ðµ\b/gi, replacement: "Ð´Ð»Ñ Ð¶ÐµÐ½Ñ‰Ð¸Ð½" },
          { pattern: /\bÐ–ÐµÐ½ÑÐºÐ¸Ðµ\b/gi, replacement: "Ð´Ð»Ñ Ð¶ÐµÐ½Ñ‰Ð¸Ð½" },
          { pattern: /\bÐœÑƒÐ¶ÑÐºÐ¾Ð¹\b/gi, replacement: "Ð´Ð»Ñ Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½" },
          { pattern: /\bÐœÑƒÐ¶ÑÐºÐ°Ñ\b/gi, replacement: "Ð´Ð»Ñ Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½" },
          { pattern: /\bÐœÑƒÐ¶ÑÐºÐ¾Ðµ\b/gi, replacement: "Ð´Ð»Ñ Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½" },
          { pattern: /\bÐœÑƒÐ¶ÑÐºÐ¸Ðµ\b/gi, replacement: "Ð´Ð»Ñ Ð¼ÑƒÐ¶Ñ‡Ð¸Ð½" },
        ];

        this.cogulTekilDonusumleri = [
          { pattern: /\bÐ¡Ð²Ð¸Ñ‚ÑˆÐ¾Ñ‚Ñ‹\b/g, replacement: "Ð¡Ð²Ð¸Ñ‚ÑˆÐ¾Ñ‚" },
          { pattern: /\bÑÐ²Ð¸Ñ‚ÑˆÐ¾Ñ‚Ñ‹\b/g, replacement: "ÑÐ²Ð¸Ñ‚ÑˆÐ¾Ñ‚" },
          { pattern: /\bÐ¡Ð²Ð¸Ñ‚ÐµÑ€Ñ‹\b/g, replacement: "Ð¡Ð²Ð¸Ñ‚ÐµÑ€" },
          { pattern: /\bÑÐ²Ð¸Ñ‚ÐµÑ€Ñ‹\b/g, replacement: "ÑÐ²Ð¸Ñ‚ÐµÑ€" },
          { pattern: /\bÐ¡Ð²Ð¸Ñ‚ÐµÑ€Ð°\b/g, replacement: "Ð¡Ð²Ð¸Ñ‚ÐµÑ€" },
          { pattern: /\bÑÐ²Ð¸Ñ‚ÐµÑ€Ð°\b/g, replacement: "ÑÐ²Ð¸Ñ‚ÐµÑ€" },
          { pattern: /\bÐŸÐ»Ð°Ñ‚ÑŒÑ\b/g, replacement: "ÐŸÐ»Ð°Ñ‚ÑŒÐµ" },
          { pattern: /\bÐ¿Ð»Ð°Ñ‚ÑŒÑ\b/g, replacement: "Ð¿Ð»Ð°Ñ‚ÑŒÐµ" },
          { pattern: /\bÐ‘Ð»ÑƒÐ·ÐºÐ¸\b/g, replacement: "Ð‘Ð»ÑƒÐ·ÐºÐ°" },
          { pattern: /\bÐ±Ð»ÑƒÐ·ÐºÐ¸\b/g, replacement: "Ð±Ð»ÑƒÐ·ÐºÐ°" },
          { pattern: /\bÐ ÑƒÐ±Ð°ÑˆÐºÐ¸\b/g, replacement: "Ð ÑƒÐ±Ð°ÑˆÐºÐ°" },
          { pattern: /\bÑ€ÑƒÐ±Ð°ÑˆÐºÐ¸\b/g, replacement: "Ñ€ÑƒÐ±Ð°ÑˆÐºÐ°" },
          { pattern: /\bÐ¤ÑƒÑ‚Ð±Ð¾Ð»ÐºÐ¸\b/g, replacement: "Ð¤ÑƒÑ‚Ð±Ð¾Ð»ÐºÐ°" },
          { pattern: /\bÑ„ÑƒÑ‚Ð±Ð¾Ð»ÐºÐ¸\b/g, replacement: "Ñ„ÑƒÑ‚Ð±Ð¾Ð»ÐºÐ°" },
          { pattern: /\bÐ¢ÑƒÐ½Ð¸ÐºÐ¸\b/g, replacement: "Ð¢ÑƒÐ½Ð¸ÐºÐ°" },
          { pattern: /\bÑ‚ÑƒÐ½Ð¸ÐºÐ¸\b/g, replacement: "Ñ‚ÑƒÐ½Ð¸ÐºÐ°" },
          { pattern: /\bÐšÐ¾Ð¼Ð±Ð¸Ð½ÐµÐ·Ð¾Ð½Ñ‹\b/g, replacement: "ÐšÐ¾Ð¼Ð±Ð¸Ð½ÐµÐ·Ð¾Ð½" },
          { pattern: /\bÐºÐ¾Ð¼Ð±Ð¸Ð½ÐµÐ·Ð¾Ð½Ñ‹\b/g, replacement: "ÐºÐ¾Ð¼Ð±Ð¸Ð½ÐµÐ·Ð¾Ð½" },
          { pattern: /\bÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ‹\b/g, replacement: "ÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚" },
          { pattern: /\bÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚Ñ‹\b/g, replacement: "ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ‚" },
          { pattern: /\bÐ¢Ñ€Ð¸ÐºÐ¾Ñ‚Ð°Ð¶Ð½Ñ‹Ðµ\b/g, replacement: "Ð¢Ñ€Ð¸ÐºÐ¾Ñ‚Ð°Ð¶Ð½Ñ‹Ð¹" },
          { pattern: /\bÑ‚Ñ€Ð¸ÐºÐ¾Ñ‚Ð°Ð¶Ð½Ñ‹Ðµ\b/g, replacement: "Ñ‚Ñ€Ð¸ÐºÐ¾Ñ‚Ð°Ð¶Ð½Ñ‹Ð¹" },
          { pattern: /\bÐžÐ´Ð½Ð¾Ñ‚Ð¾Ð½Ð½Ñ‹Ðµ\b/g, replacement: "ÐžÐ´Ð½Ð¾Ñ‚Ð¾Ð½Ð½Ñ‹Ð¹" },
          { pattern: /\bÐ¾Ð´Ð½Ð¾Ñ‚Ð¾Ð½Ð½Ñ‹Ðµ\b/g, replacement: "Ð¾Ð´Ð½Ð¾Ñ‚Ð¾Ð½Ð½Ñ‹Ð¹" },
          { pattern: /\bÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¸Ðµ\b/g, replacement: "ÐšÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¸Ð¹" },
          { pattern: /\bÐºÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¸Ðµ\b/g, replacement: "ÐºÐ»Ð°ÑÑÐ¸Ñ‡ÐµÑÐºÐ¸Ð¹" },
          { pattern: /\bÐ›ÐµÑ‚Ð½Ð¸Ðµ\b/g, replacement: "Ð›ÐµÑ‚Ð½Ð¸Ð¹" },
          { pattern: /\bÐ»ÐµÑ‚Ð½Ð¸Ðµ\b/g, replacement: "Ð»ÐµÑ‚Ð½Ð¸Ð¹" },
          { pattern: /\bÐ—Ð¸Ð¼Ð½Ð¸Ðµ\b/g, replacement: "Ð—Ð¸Ð¼Ð½Ð¸Ð¹" },
          { pattern: /\bÐ·Ð¸Ð¼Ð½Ð¸Ðµ\b/g, replacement: "Ð·Ð¸Ð¼Ð½Ð¸Ð¹" },
          { pattern: /\bÐŸÐ»ÑÐ¶Ð½Ñ‹Ðµ\b/g, replacement: "ÐŸÐ»ÑÐ¶Ð½Ñ‹Ð¹" },
          { pattern: /\bÐ¿Ð»ÑÐ¶Ð½Ñ‹Ðµ\b/g, replacement: "Ð¿Ð»ÑÐ¶Ð½Ñ‹Ð¹" },
          { pattern: /\bÐ¥Ð»Ð¾Ð¿ÐºÐ¾Ð²Ñ‹Ðµ\b/g, replacement: "Ð¥Ð»Ð¾Ð¿ÐºÐ¾Ð²Ñ‹Ð¹" },
          { pattern: /\bÑ…Ð»Ð¾Ð¿ÐºÐ¾Ð²Ñ‹Ðµ\b/g, replacement: "Ñ…Ð»Ð¾Ð¿ÐºÐ¾Ð²Ñ‹Ð¹" },
          { pattern: /\bÐšÐ¾Ð¶Ð°Ð½Ñ‹Ðµ\b/g, replacement: "ÐšÐ¾Ð¶Ð°Ð½Ñ‹Ð¹" },
          { pattern: /\bÐºÐ¾Ð¶Ð°Ð½Ñ‹Ðµ\b/g, replacement: "ÐºÐ¾Ð¶Ð°Ð½Ñ‹Ð¹" },
          { pattern: /\bÐ”Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ\b/g, replacement: "Ð”Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ð¹" },
          { pattern: /\bÐ´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ðµ\b/g, replacement: "Ð´Ð¾Ð¼Ð°ÑˆÐ½Ð¸Ð¹" },
          { pattern: /\bÐ¢Ñ€ÐµÐºÐºÐ¸Ð½Ð³Ð¾Ð²Ñ‹Ðµ\b/g, replacement: "Ð¢Ñ€ÐµÐºÐºÐ¸Ð½Ð³Ð¾Ð²Ñ‹Ð¹" },
          { pattern: /\bÑ‚Ñ€ÐµÐºÐºÐ¸Ð½Ð³Ð¾Ð²Ñ‹Ðµ\b/g, replacement: "Ñ‚Ñ€ÐµÐºÐºÐ¸Ð½Ð³Ð¾Ð²Ñ‹Ð¹" },
          { pattern: /\bÐžÐ±Ð»ÐµÐ³Ð°ÑŽÑ‰Ð¸Ðµ\b/g, replacement: "ÐžÐ±Ð»ÐµÐ³Ð°ÑŽÑ‰Ð¸Ð¹" },
          { pattern: /\bÐ¾Ð±Ð»ÐµÐ³Ð°ÑŽÑ‰Ð¸Ðµ\b/g, replacement: "Ð¾Ð±Ð»ÐµÐ³Ð°ÑŽÑ‰Ð¸Ð¹" },
        ];

        this.cogulIstisnalar = [
          "ÐšÑ€Ð¾ÑÑÐ¾Ð²ÐºÐ¸","ÐºÑ€Ð¾ÑÑÐ¾Ð²ÐºÐ¸","Ð¡Ð°Ð½Ð´Ð°Ð»Ð¸Ð¸","ÑÐ°Ð½Ð´Ð°Ð»Ð¸Ð¸","Ð‘Ð¾Ñ‚Ð¸Ð½ÐºÐ¸","Ð±Ð¾Ñ‚Ð¸Ð½ÐºÐ¸","Ð¡Ð°Ð¿Ð¾Ð³Ð¸","ÑÐ°Ð¿Ð¾Ð³Ð¸",
          "Ð¢ÑƒÑ„Ð»Ð¸","Ñ‚ÑƒÑ„Ð»Ð¸","ÐšÐµÐ´Ñ‹","ÐºÐµÐ´Ñ‹","Ð¢Ð°Ð¿Ð¾Ñ‡ÐºÐ¸","Ñ‚Ð°Ð¿Ð¾Ñ‡ÐºÐ¸","ÐŸÐ¸Ð½ÐµÑ‚ÐºÐ¸","Ð¿Ð¸Ð½ÐµÑ‚ÐºÐ¸",
          "Ð¢Ñ€ÑƒÑÑ‹","Ñ‚Ñ€ÑƒÑÑ‹","Ð‘Ñ€ÑŽÐºÐ¸","Ð±Ñ€ÑŽÐºÐ¸","Ð”Ð¶Ð¸Ð½ÑÑ‹","Ð´Ð¶Ð¸Ð½ÑÑ‹","Ð¨Ð¾Ñ€Ñ‚Ñ‹","ÑˆÐ¾Ñ€Ñ‚Ñ‹","ÐžÑ‡ÐºÐ¸","Ð¾Ñ‡ÐºÐ¸"
        ];

        // âœ… WB fix: baÅŸlÄ±k edat/baÄŸlaÃ§ ile bitmesin
        this.yasakSonKelimeler = [
          "Ñ","ÑÐ¾","Ð¸Ð·","Ð¾Ñ‚","Ð´Ð¾","Ð±ÐµÐ·","Ð´Ð»Ñ","Ðº","ÐºÐ¾","Ð¾","Ð¾Ð±","Ð¾Ð±Ð¾","Ñƒ","Ð²","Ð²Ð¾","Ð½Ð°","Ð·Ð°","Ð¿Ð¾","Ð¿Ð¾Ð´","Ð½Ð°Ð´",
          "Ð¸","Ð¸Ð»Ð¸","Ð°","Ð½Ð¾","Ñ‡Ñ‚Ð¾","ÐºÐ°Ðº"
        ];
      }

      noktalamaTemizle(t) {
        return t
          .replace(/\s*:\s*/g, " ")
          .replace(/\s*â€“\s*/g, " ")
          .replace(/\s*â€”\s*/g, " ")
          .replace(/\s+-\s+/g, " ")
          .replace(/,\s*,/g, ",")
          .replace(/,\s+([Ð-Ð¯Ð][Ð°-ÑÑ‘]+)/g, " $1")
          .replace(/,\s+([Ð°-ÑÑ‘]+(Ð°Ñ|Ð¾Ðµ|Ñ‹Ð¹|Ð¸Ðµ|Ñ‹Ðµ))\b/g, " $1");
      }

      cogulTekilDonustur(t) {
        for (const e of this.cogulIstisnalar) if (t.includes(e)) return t;
        for (const { pattern, replacement } of this.cogulTekilDonusumleri) t = t.replace(pattern, replacement);
        return t;
      }

      hedefKitleDonustur(t) {
        this.hedefKitleDonusumleri.forEach(({ pattern, replacement }) => {
          t = t.replace(pattern, replacement);
        });
        return t;
      }

      boslukDuzelt(t) {
        return t.replace(/\s+/g, " ").trim();
      }

      buyukKucukHarfDuzelt(t) {
        return t ? t[0].toUpperCase() + t.slice(1) : t;
      }

      // âœ… WB fix: sonda kalan noktalama temizliÄŸi
      sonNoktalamaTemizle(t) {
        return t.replace(/[,\.;:\-â€“â€”]+$/g, "").trim();
      }

      // âœ… WB fix: sonda tek baÅŸÄ±na kalan edat/baÄŸlaÃ§ varsa kaldÄ±r
      sonYasakKelimeTemizle(t) {
        const parts = t.split(/\s+/).filter(Boolean);
        if (parts.length === 0) return "";
        const last = parts[parts.length - 1].toLowerCase().replace(/[.,;:]+$/g, "");
        if (this.yasakSonKelimeler.includes(last)) parts.pop();
        return parts.join(" ").trim();
      }

      // âœ… WB fix: kÄ±rpma sonrasÄ± edat/virgÃ¼l hatalarÄ±nÄ± dÃ¼zelt
      karakterSinirla(t, e = 60) {
        if (t.length <= e) return t;

        let n = t.substring(0, e);
        let a = n.lastIndexOf(" ");
        n = a > 0 ? n.substring(0, a).trim() : n.trim();

        n = this.sonNoktalamaTemizle(n);
        n = this.sonYasakKelimeTemizle(n);
        n = this.sonNoktalamaTemizle(n);

        return n;
      }

      duzenle(t) {
        if (!t || String(t).trim() === "") return "";

        t = String(t).trim();
        t = this.noktalamaTemizle(t);
        t = this.cogulTekilDonustur(t);
        t = this.hedefKitleDonustur(t);
        t = this.boslukDuzelt(t);
        t = this.buyukKucukHarfDuzelt(t);

        t = this.karakterSinirla(t, 60);

        // final gÃ¼venlik (bazÄ± edge-caseâ€™lerde yeniden sonda kalabiliyor)
        t = this.sonNoktalamaTemizle(t);
        t = this.sonYasakKelimeTemizle(t);
        t = this.sonNoktalamaTemizle(t);

        return t;
      }
    }

    const uploadArea = document.getElementById("uploadArea"),
      fileInput = document.getElementById("fileInput"),
      progressContainer = document.getElementById("progressContainer"),
      progressFill = document.getElementById("progressFill"),
      resultArea = document.getElementById("resultArea"),
      downloadBtn = document.getElementById("downloadBtn");

    let processedWorkbook = null,
      duzenleyici = new WBBaslikDuzenleyici();

    function processFile(file) {
      const start = Date.now();
      progressContainer.style.display = "block";
      resultArea.style.display = "none";
      updateProgress(10);

      const reader = new FileReader();
      reader.onload = function (ev) {
        try {
          updateProgress(30);
          const data = new Uint8Array(ev.target.result);
          const wb = XLSX.read(data, { type: "array" });
          updateProgress(50);

          const sheetName = wb.SheetNames[0];
          const sheet = wb.Sheets[sheetName];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

          updateProgress(60);

          const headers = rows[0];
          const newHeaders = [...headers];
          const out = [newHeaders];

          let processedCols = 0;

          headers.forEach((h) => {
            if (
              h &&
              (String(h).toLowerCase().includes("isim") ||
                String(h).toLowerCase().includes("Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ") ||
                String(h).toLowerCase().includes("name"))
            ) {
              newHeaders.push(h + "_dÃ¼zenlenmiÅŸ");
              processedCols++;
            }
          });

          out[0] = newHeaders;
          updateProgress(70);

          for (let r = 1; r < rows.length; r++) {
            const row = rows[r];
            const newRow = [...row];

            headers.forEach((h, idx) => {
              if (
                h &&
                (String(h).toLowerCase().includes("isim") ||
                  String(h).toLowerCase().includes("Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ") ||
                  String(h).toLowerCase().includes("name"))
              ) {
                const original = row[idx] || "";
                const edited = duzenleyici.duzenle(original);
                newRow.push(edited);
              }
            });

            out.push(newRow);

            if (r % 100 === 0) updateProgress(70 + (r / rows.length) * 20);
          }

          updateProgress(95);

          const outSheet = XLSX.utils.aoa_to_sheet(out);
          const outWb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(outWb, outSheet, sheetName);

          processedWorkbook = outWb;
          updateProgress(100);

          const end = Date.now();
          const sec = ((end - start) / 1000).toFixed(1);
          showResults(out, sec, processedCols);
        } catch (err) {
          console.error("Ä°ÅŸleme hatasÄ±:", err);
          alert("Dosya iÅŸlenirken bir hata oluÅŸtu: " + err.message);
          progressContainer.style.display = "none";
        }
      };

      reader.readAsArrayBuffer(file);
    }

    function updateProgress(p) {
      progressFill.style.width = p + "%";
      progressFill.textContent = Math.round(p) + "%";
    }

    function showResults(out, sec, processedCols) {
      setTimeout(() => {
        progressContainer.style.display = "none";
        resultArea.style.display = "block";

        document.getElementById("totalRows").textContent = out.length - 1;
        document.getElementById("totalColumns").textContent = processedCols;
        document.getElementById("processTime").textContent = sec + "s";

        createPreviewTable(out);
        resultArea.scrollIntoView({ behavior: "smooth" });
      }, 300);
    }

    function createPreviewTable(out) {
      const header = out[0];
      const preview = out.slice(1, 11);

      let html = '<h3 class="preview-title">ðŸ“Š Ã–nizleme (Ä°lk 10 SatÄ±r)</h3>';
      html += '<table class="preview-table"><thead><tr>';
      header.forEach((h) => (html += `<th>${h || ""}</th>`));
      html += "</tr></thead><tbody>";

      preview.forEach((row) => {
        html += "<tr>";
        header.forEach((_, i) => {
          html += `<td>${row[i] || ""}</td>`;
        });
        html += "</tr>";
      });

      html += "</tbody></table>";
      document.getElementById("previewContainer").innerHTML = html;
    }

    uploadArea.addEventListener("click", () => fileInput.click());

    uploadArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      uploadArea.classList.add("dragover");
    });

    uploadArea.addEventListener("dragleave", () => {
      uploadArea.classList.remove("dragover");
    });

    uploadArea.addEventListener("drop", (e) => {
      e.preventDefault();
      uploadArea.classList.remove("dragover");
      const file = e.dataTransfer.files[0];
      if (file) processFile(file);
    });

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) processFile(file);
    });

    downloadBtn.addEventListener("click", () => {
      if (!processedWorkbook) return;
      const t = new Date().toISOString().slice(0, 19).replace(/:/g, "-");
      const filename = `WB_LCW_${t}.xlsx`;
      XLSX.writeFile(processedWorkbook, filename);
    });
  </script>
</body>
</html>
