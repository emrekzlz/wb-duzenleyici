<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WB Ba≈ülƒ±k D√ºzenleyici v3.0 - LC Waikiki</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #0051A5 0%, #003D7A 100%); min-height: 100vh; padding: 40px 20px; }
    .container { max-width: 1000px; margin: 0 auto; }
    .header { background: #fff; padding: 40px; border-radius: 20px 20px 0 0; box-shadow: 0 4px 20px rgba(0,0,0,.15); text-align: center; }
    .logo-text { font-size: 3em; font-weight: 900; color: #0051A5; letter-spacing: -2px; margin-bottom: 20px; }
    .header h1 { color: #0051A5; font-size: 2.2em; font-weight: 700; margin-bottom: 10px; }
    .subtitle { color: #666; font-size: 1.1em; margin-bottom: 20px; }
    .version-badge { display: inline-block; background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 8px 20px; border-radius: 25px; font-size: .85em; font-weight: 600; }
    .main-content { background: #fff; padding: 50px 40px; border-radius: 0 0 20px 20px; box-shadow: 0 4px 20px rgba(0,0,0,.15); }
    .upload-area { border: 3px dashed #0051A5; border-radius: 15px; padding: 80px 40px; text-align: center; background: linear-gradient(135deg, #f8f9ff, #e8f0ff); cursor: pointer; transition: all .3s; }
    .upload-area:hover { border-color: #003D7A; transform: translateY(-2px); box-shadow: 0 10px 30px rgba(0,81,165,.2); }
    .upload-area.dragover { background: linear-gradient(135deg, #e8f0ff, #d0e4ff); transform: scale(1.02); }
    .upload-icon { font-size: 5em; margin-bottom: 20px; }
    .upload-text { font-size: 1.4em; color: #0051A5; font-weight: 600; margin-bottom: 15px; }
    .upload-hint { color: #666; }
    input[type="file"] { display: none; }
    .progress-container { display: none; margin: 40px 0; }
    .progress-bar { width: 100%; height: 35px; background: #e8f0ff; border-radius: 20px; overflow: hidden; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #0051A5, #003D7A); width: 0%; transition: width .3s; display: flex; align-items: center; justify-content: center; color: #fff; font-weight: 700; font-size: 1.1em; }
    .result-area { display: none; margin-top: 40px; }
    .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; margin-bottom: 40px; }
    .stat-card { background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 35px 30px; border-radius: 15px; text-align: center; box-shadow: 0 8px 20px rgba(0,81,165,.3); transition: transform .3s; }
    .stat-card:hover { transform: translateY(-5px); }
    .stat-number { font-size: 3em; font-weight: 800; margin-bottom: 10px; }
    .stat-label { font-size: 1em; opacity: .95; }
    .download-btn { display: inline-block; background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 18px 50px; border-radius: 12px; font-weight: 800; font-size: 1.2em; cursor: pointer; border: none; transition: all .3s; box-shadow: 0 6px 20px rgba(0,81,165,.3); }
    .download-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,81,165,.4); }
    .preview-table { width: 100%; margin-top: 40px; border-collapse: collapse; background: #fff; border-radius: 15px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,.1); }
    .preview-table th { background: linear-gradient(135deg, #0051A5, #003D7A); color: #fff; padding: 18px; text-align: left; font-weight: 700; }
    .preview-table td { padding: 15px 18px; border-bottom: 1px solid #e8f0ff; }
    .preview-table tr:hover { background: #f8f9ff; }
    .preview-title { color: #0051A5; font-size: 1.5em; font-weight: 700; margin-top: 50px; margin-bottom: 20px; }
    .footer { text-align: center; margin-top: 30px; color: #fff; font-size: .9em; opacity: .9; }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="logo-text">LC Waikiki</div>
      <h1>Wildberries Ba≈ülƒ±k D√ºzenleyici</h1>
      <p class="subtitle">Genel kural seti ile kƒ±sa isim √ºretir</p>
      <span class="version-badge">v3.0 (Genel Kurallar)</span>
    </div>

    <div class="main-content">
      <div class="upload-area" id="uploadArea">
        <div class="upload-icon">üìä</div>
        <div class="upload-text">Excel dosyanƒ±zƒ± buraya s√ºr√ºkleyin</div>
        <div class="upload-hint">veya tƒ±klayarak dosya se√ßin (.xlsx, .xls)</div>
        <input type="file" id="fileInput" accept=".xlsx,.xls" />
      </div>

      <div class="progress-container" id="progressContainer">
        <div class="progress-bar"><div class="progress-fill" id="progressFill">0%</div></div>
      </div>

      <div class="result-area" id="resultArea">
        <div class="stats">
          <div class="stat-card">
            <div class="stat-number" id="totalRows">0</div>
            <div class="stat-label">Toplam Satƒ±r</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="totalColumns">0</div>
            <div class="stat-label">ƒ∞≈ülenen S√ºtun</div>
          </div>
          <div class="stat-card">
            <div class="stat-number" id="processTime">0s</div>
            <div class="stat-label">ƒ∞≈ülem S√ºresi</div>
          </div>
        </div>

        <div style="text-align:center;margin:40px 0;">
          <button class="download-btn" id="downloadBtn">üì• D√ºzenlenmi≈ü Dosyayƒ± ƒ∞ndir</button>
        </div>

        <div id="previewContainer"></div>
      </div>
    </div>

    <div class="footer">¬© 2026 LC Waikiki - WB Ba≈ülƒ±k D√ºzenleyici</div>
  </div>

  <script>
    class WBBaslikDuzenleyici {
      constructor(options = {}) {
        this.opts = {
          maxLen: 60,
          includeQuantity: false,
          sentenceCase: true,
          moveLeadingFeatures: true,
          ...options
        };

        this.hedefKitleDonusumleri = [
          { pattern: /\b–ñ–µ–Ω—â–∏–Ω–∞\b/gi, replacement: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
          { pattern: /\b–ú—É–∂—á–∏–Ω–∞\b/gi, replacement: "–¥–ª—è –º—É–∂—á–∏–Ω" },
          { pattern: /\b–î–µ–≤—É—à–∫–∞\b/gi, replacement: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
          { pattern: /\b–î–µ–≤–æ—á–∫–∞\b/gi, replacement: "–¥–ª—è –¥–µ–≤–æ—á–µ–∫" },
          { pattern: /\b–ú–∞–ª—å—á–∏–∫\b/gi, replacement: "–¥–ª—è –º–∞–ª—å—á–∏–∫–æ–≤" },

          { pattern: /\b–ñ–µ–Ω—Å–∫–∏–π\b/gi, replacement: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
          { pattern: /\b–ñ–µ–Ω—Å–∫–∞—è\b/gi, replacement: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },
          { pattern: /\b–ñ–µ–Ω—Å–∫–æ–µ\b/gi, replacement: "–¥–ª—è –∂–µ–Ω—â–∏–Ω" },

          { pattern: /\b–ú—É–∂—Å–∫–æ–π\b/gi, replacement: "–¥–ª—è –º—É–∂—á–∏–Ω" },
          { pattern: /\b–ú—É–∂—Å–∫–∞—è\b/gi, replacement: "–¥–ª—è –º—É–∂—á–∏–Ω" },
          { pattern: /\b–ú—É–∂—Å–∫–æ–µ\b/gi, replacement: "–¥–ª—è –º—É–∂—á–∏–Ω" }
        ];

        this.cogulTekilDonusumleri = [
          { pattern: /\b–°–≤–∏—Ç—à–æ—Ç—ã\b/g, replacement: "–°–≤–∏—Ç—à–æ—Ç" },
          { pattern: /\b—Å–≤–∏—Ç—à–æ—Ç—ã\b/g, replacement: "—Å–≤–∏—Ç—à–æ—Ç" },
          { pattern: /\b–°–≤–∏—Ç–µ—Ä—ã\b/g, replacement: "–°–≤–∏—Ç–µ—Ä" },
          { pattern: /\b—Å–≤–∏—Ç–µ—Ä—ã\b/g, replacement: "—Å–≤–∏—Ç–µ—Ä" },
          { pattern: /\b–ü–ª–∞—Ç—å—è\b/g, replacement: "–ü–ª–∞—Ç—å–µ" },
          { pattern: /\b–ø–ª–∞—Ç—å—è\b/g, replacement: "–ø–ª–∞—Ç—å–µ" },
          { pattern: /\b–ë–ª—É–∑–∫–∏\b/g, replacement: "–ë–ª—É–∑–∫–∞" },
          { pattern: /\b–±–ª—É–∑–∫–∏\b/g, replacement: "–±–ª—É–∑–∫–∞" },
          { pattern: /\b–†—É–±–∞—à–∫–∏\b/g, replacement: "–†—É–±–∞—à–∫–∞" },
          { pattern: /\b—Ä—É–±–∞—à–∫–∏\b/g, replacement: "—Ä—É–±–∞—à–∫–∞" },
          { pattern: /\b–§—É—Ç–±–æ–ª–∫–∏\b/g, replacement: "–§—É—Ç–±–æ–ª–∫–∞" },
          { pattern: /\b—Ñ—É—Ç–±–æ–ª–∫–∏\b/g, replacement: "—Ñ—É—Ç–±–æ–ª–∫–∞" },
          { pattern: /\b–ö–æ–º–±–∏–Ω–µ–∑–æ–Ω—ã\b/g, replacement: "–ö–æ–º–±–∏–Ω–µ–∑–æ–Ω" },
          { pattern: /\b–∫–æ–º–±–∏–Ω–µ–∑–æ–Ω—ã\b/g, replacement: "–∫–æ–º–±–∏–Ω–µ–∑–æ–Ω" },
          { pattern: /\b–ö–æ–º–ø–ª–µ–∫—Ç—ã\b/g, replacement: "–ö–æ–º–ø–ª–µ–∫—Ç" },
          { pattern: /\b–∫–æ–º–ø–ª–µ–∫—Ç—ã\b/g, replacement: "–∫–æ–º–ø–ª–µ–∫—Ç" }
        ];

        this.cogulIstisnalar = [
          "–ö—Ä–æ—Å—Å–æ–≤–∫–∏","–∫—Ä–æ—Å—Å–æ–≤–∫–∏","–°–∞–Ω–¥–∞–ª–∏–∏","—Å–∞–Ω–¥–∞–ª–∏–∏","–ë–æ—Ç–∏–Ω–∫–∏","–±–æ—Ç–∏–Ω–∫–∏","–°–∞–ø–æ–≥–∏","—Å–∞–ø–æ–≥–∏",
          "–¢—É—Ñ–ª–∏","—Ç—É—Ñ–ª–∏","–ö–µ–¥—ã","–∫–µ–¥—ã","–¢–∞–ø–æ—á–∫–∏","—Ç–∞–ø–æ—á–∫–∏","–ü–∏–Ω–µ—Ç–∫–∏","–ø–∏–Ω–µ—Ç–∫–∏",
          "–¢—Ä—É—Å—ã","—Ç—Ä—É—Å—ã","–ë—Ä—é–∫–∏","–±—Ä—é–∫–∏","–î–∂–∏–Ω—Å—ã","–¥–∂–∏–Ω—Å—ã","–®–æ—Ä—Ç—ã","—à–æ—Ä—Ç—ã","–û—á–∫–∏","–æ—á–∫–∏",
          "–ü–∞–ª—å—Ç–æ","–ø–∞–ª—å—Ç–æ"
        ];

        this.yasakSonKelimeler = [
          "—Å","—Å–æ","–∏–∑","–æ—Ç","–¥–æ","–±–µ–∑","–¥–ª—è","–∫","–∫–æ","–æ","–æ–±","–æ–±–æ","—É","–≤","–≤–æ","–Ω–∞","–∑–∞","–ø–æ","–ø–æ–¥","–Ω–∞–¥",
          "–∏","–∏–ª–∏","–∞","–Ω–æ","—á—Ç–æ","–∫–∞–∫"
        ];

        this.urunTipleri = [
          "–ü–∏–∂–∞–º–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç","–ë—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä-—Ñ—É—Ç–±–æ–ª–∫–∞","–ë—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä","–ö–æ–º–±–∏–Ω–µ–∑–æ–Ω","–§—É—Ç–±–æ–ª–∫–∞","–ë–ª—É–∑–∫–∞",
          "–†—É–±–∞—à–∫–∞","–°–≤–∏—Ç—à–æ—Ç","–î–∂–æ–≥–≥–µ—Ä—ã","–ë—Ä—é–∫–∏","–®–æ—Ä—Ç—ã","–ü–ª–∞—Ç—å–µ","–Æ–±–∫–∞","–ö—É–ø–∞–ª—å–Ω–∏–∫","–ö–æ–º–ø–ª–µ–∫—Ç",
          "–¢—Ä—É—Å—ã","–ü–∞–ª—å—Ç–æ","–ö—Ä–æ—Å—Å–æ–≤–∫–∏","–°–∞–Ω–¥–∞–ª–∏–∏","–ë–æ—Ç–∏–Ω–∫–∏","–°–∞–ø–æ–≥–∏","–¢—É—Ñ–ª–∏","–ü–∏–Ω–µ—Ç–∫–∏","–ù–æ—Å–∫–∏",
          "–õ–µ–≥–≥–∏–Ω—Å—ã","–ö–∞—Ä–¥–∏–≥–∞–Ω","–¢–æ–ª—Å—Ç–æ–≤–∫–∞","–ö—É—Ä—Ç–∫–∞","–ü–∞—Ä–∫–∞","–ñ–∏–ª–µ—Ç","–õ–æ—Ñ–µ—Ä—ã","–ë–∞–ª–µ—Ç–∫–∏"
        ];

        this.onOzellikMap = [
          { re: /^–ö—Ä—É–≥–ª—ã–π –≤—ã—Ä–µ–∑\b/i, tail: "—Å –∫—Ä—É–≥–ª—ã–º –≤—ã—Ä–µ–∑–æ–º" },
          { re: /^V-–æ–±—Ä–∞–∑–Ω—ã–π –≤—ã—Ä–µ–∑\b/i, tail: "—Å V –≤—ã—Ä–µ–∑–æ–º" },
          { re: /^V-–æ–±—Ä–∞–∑–Ω—ã–º –≤—ã—Ä–µ–∑–æ–º\b/i, tail: "—Å V –≤—ã—Ä–µ–∑–æ–º" },
          { re: /^–ö–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –≤—ã—Ä–µ–∑\b/i, tail: "—Å –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–º –≤—ã—Ä–µ–∑–æ–º" },
          { re: /^–í–æ—Ä–æ—Ç–Ω–∏–∫-—Å—Ç–æ–π–∫–∞\b/i, tail: "—Å –≤–æ—Ä–æ—Ç–Ω–∏–∫–æ–º —Å—Ç–æ–π–∫–æ–π" }
        ];
      }

      boslukDuzelt(t) { return t.replace(/\s+/g, " ").trim(); }

      noktalamaTemizle(t) {
        return t
          .replace(/\s*:\s*/g, " ")
          .replace(/\s*[‚Äì‚Äî]\s*/g, " ")
          .replace(/\s+-\s+/g, " ")
          .replace(/\s*,\s*/g, ", ")
          .replace(/,\s*,/g, ",")
          .replace(/\s+/g, " ")
          .trim();
      }

      sonNoktalamaTemizle(t) { return t.replace(/[,\.;:\-‚Äì‚Äî]+$/g, "").trim(); }

      sonYasakKelimeTemizle(t) {
        const parts = t.split(/\s+/).filter(Boolean);
        if (!parts.length) return "";
        const last = parts[parts.length - 1].toLowerCase().replace(/[.,;:]+$/g, "");
        if (this.yasakSonKelimeler.includes(last)) parts.pop();
        return parts.join(" ").trim();
      }

      removeQuantity(t) {
        if (!t) return "";
        return t
          .replace(/[, ]*\b\d{1,2}\s*(—É–ø–∞–∫–æ–≤–∫(–∏|–∞)?|—É–ø\.?)\b/gi, "")
          .replace(/[, ]*\b\d{1,2}\s*—à—Ç\.?\b/gi, "")
          .replace(/[, ]*\b\d{1,2}\s*(pcs|pc)\b/gi, "")
          .replace(/[, ]*\b\d{1,2}\b\s*$/g, "")
          .replace(/\s+/g, " ")
          .trim();
      }

      normalizeCase(t) {
        if (!t) return "";
        t = t.replace(/\b–î–ª—è\b/g, "–¥–ª—è");
        if (!this.opts.sentenceCase) return t;
        const low = t.toLowerCase();
        return low.charAt(0).toUpperCase() + low.slice(1);
      }

      cogulTekilDonustur(t) {
        for (const e of this.cogulIstisnalar) if (t.includes(e)) return t;
        for (const { pattern, replacement } of this.cogulTekilDonusumleri) t = t.replace(pattern, replacement);
        return t;
      }

      hedefKitleDonustur(t) {
        this.hedefKitleDonusumleri.forEach(({ pattern, replacement }) => { t = t.replace(pattern, replacement); });
        t = t.replace(/\b–¥–ª—è (–∂–µ–Ω—â–∏–Ω|–º—É–∂—á–∏–Ω|–º–∞–ª—å—á–∏–∫–æ–≤|–¥–µ–≤–æ—á–µ–∫)\b(?:\s+–¥–ª—è \1\b)+/gi, "–¥–ª—è $1");
        return t;
      }

      findFirstProductIndex(t) {
        const lower = t.toLowerCase();
        let best = -1;
        for (const p of this.urunTipleri) {
          const i = lower.indexOf(p.toLowerCase());
          if (i !== -1 && (best === -1 || i < best)) best = i;
        }
        return best;
      }

      headToTail(head) {
        for (const m of this.onOzellikMap) {
          if (m.re.test(head)) return m.tail;
        }
        return null;
      }

      ozellikSiraDuzelt(t) {
        if (!t || !this.opts.moveLeadingFeatures) return t;

        const idx = this.findFirstProductIndex(t);
        if (idx <= 0) return t;

        const head = t.slice(0, idx).trim();
        const rest = t.slice(idx).trim();

        const tail = this.headToTail(head);
        if (!tail) return t;

        if (new RegExp(tail, "i").test(rest)) return rest;
        return (rest + " " + tail).replace(/\s+/g, " ").trim();
      }

      karakterSinirla(t) {
        const max = this.opts.maxLen;
        if (t.length <= max) return t;

        let n = t.substring(0, max);
        const a = n.lastIndexOf(" ");
        n = a > 0 ? n.substring(0, a).trim() : n.trim();

        n = this.sonNoktalamaTemizle(n);
        n = this.sonYasakKelimeTemizle(n);
        n = this.sonNoktalamaTemizle(n);

        return n;
      }

      duzenle(input) {
        if (!input || String(input).trim() === "") return "";

        let t = String(input).trim();

        t = this.noktalamaTemizle(t);
        t = this.boslukDuzelt(t);

        t = this.cogulTekilDonustur(t);
        t = this.hedefKitleDonustur(t);

        t = this.ozellikSiraDuzelt(t);

        if (!this.opts.includeQuantity) {
          t = this.removeQuantity(t);
        }

        t = this.boslukDuzelt(t);
        t = this.karakterSinirla(t);

        t = this.sonNoktalamaTemizle(t);
        t = this.sonYasakKelimeTemizle(t);
        t = this.sonNoktalamaTemizle(t);

        t = this.normalizeCase(t);
        return t;
      }
    }

    const uploadArea = document.getElementById("uploadArea");
    const fileInput = document.getElementById("fileInput");
    const progressContainer = document.getElementById("progressContainer");
    const progressFill = document.getElementById("progressFill");
    const resultArea = document.getElementById("resultArea");
    const downloadBtn = document.getElementById("downloadBtn");

    let processedWorkbook = null;
    let duzenleyici = new WBBaslikDuzenleyici();

    function processFile(file) {
      const start = Date.now();
      progressContainer.style.display = "block";
      resultArea.style.display = "none";
      updateProgress(10);

      const reader = new FileReader();
      reader.onload = function (ev) {
        try {
          updateProgress(30);
          const data = new Uint8Array(ev.target.result);
          const wb = XLSX.read(data, { type: "array" });
          updateProgress(50);

          const sheetName = wb.SheetNames[0];
          const sheet = wb.Sheets[sheetName];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

          updateProgress(60);

          const headers = rows[0] || [];
          const outHeader = [...headers];

          // ƒ∞≈ülenecek ba≈ülƒ±k s√ºtunlarƒ±nƒ± bul
          const titleColIdxs = [];
          headers.forEach((h, idx) => {
            if (!h) return;
            const s = String(h).toLowerCase();
            if (s.includes("isim") || s.includes("–Ω–∞–∑–≤–∞–Ω–∏–µ") || s.includes("name")) {
              titleColIdxs.push(idx);
              outHeader.push(String(h) + "_kƒ±sa");
            }
          });

          const out = [outHeader];
          updateProgress(70);

          for (let r = 1; r < rows.length; r++) {
            const row = rows[r] || [];
            const newRow = [...row];

            for (const idx of titleColIdxs) {
              const original = row[idx] || "";
              const edited = duzenleyici.duzenle(original);
              newRow.push(edited);
            }

            out.push(newRow);

            if (r % 200 === 0) updateProgress(70 + (r / Math.max(1, rows.length)) * 20);
          }

          updateProgress(95);

          const outSheet = XLSX.utils.aoa_to_sheet(out);
          const outWb = XLSX.utils.book_new();
          XLSX.utils.book_append_sheet(outWb, outSheet, sheetName);

          processedWorkbook = outWb;
          updateProgress(100);

          const sec = ((Date.now() - start) / 1000).toFixed(1);
          showResults(out, sec, titleColIdxs.length);
        } catch (err) {
          console.error(err);
          alert("Dosya i≈ülenirken hata olu≈ütu: " + err.message);
          progressContainer.style.display = "none";
        }
      };

      reader.readAsArrayBuffer(file);
    }

    function updateProgress(p) {
      progressFill.style.width = p + "%";
      progressFill.textContent = Math.round(p) + "%";
    }

    function showResults(out, sec, processedCols) {
      setTimeout(() => {
        progressContainer.style.display = "none";
        resultArea.style.display = "block";

        document.getElementById("totalRows").textContent = out.length - 1;
        document.getElementById("totalColumns").textContent = processedCols;
        document.getElementById("processTime").textContent = sec + "s";

        createPreviewTable(out);
        resultArea.scrollIntoView({ behavior: "smooth" });
      }, 250);
    }

    function createPreviewTable(out) {
      const header = out[0];
      const preview = out.slice(1, 11);

      let html = '<h3 class="preview-title">√ñnizleme (ƒ∞lk 10 Satƒ±r)</h3>';
      html += '<table class="preview-table"><thead><tr>';
      header.forEach((h) => (html += `<th>${escapeHtml(h || "")}</th>`));
      html += "</tr></thead><tbody>";

      preview.forEach((row) => {
        html += "<tr>";
        header.forEach((_, i) => { html += `<td>${escapeHtml(row[i] || "")}</td>`; });
        html += "</tr>";
      });

      html += "</tbody></table>";
      document.getElementById("previewContainer").innerHTML = html;
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    uploadArea.addEventListener("click", () => fileInput.click());
    uploadArea.addEventListener("dragover", (e) => { e.preventDefault(); uploadArea.classList.add("dragover"); });
    uploadArea.addEventListener("dragleave", () => uploadArea.classList.remove("dragover"));
    uploadArea.addEventListener("drop", (e) => {
      e.preventDefault();
      uploadArea.classList.remove("dragover");
      const file = e.dataTransfer.files[0];
      if (file) processFile(file);
    });
    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) processFile(file);
    });

    downloadBtn.addEventListener("click", () => {
      if (!processedWorkbook) return;
      const t = new Date().toISOString().slice(0, 19).replace(/:/g, "-");
      XLSX.writeFile(processedWorkbook, `WB_LCW_${t}.xlsx`);
    });
  </script>
</body>
</html>
